<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ v2.0.0 - ê·¼íƒœê´€ë¦¬ ì‹œìŠ¤í…œ</title>
    <link rel="stylesheet" href="../style.css?v=2.2.0">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
    <script src="../app.js?v=2.2.0"></script>
    <style>
        .nav-tabs {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            border-bottom: 1px solid var(--border);
            padding-bottom: 1rem;
        }

        .nav-link {
            padding: 0.5rem 1rem;
            color: var(--text-muted);
            text-decoration: none;
            cursor: pointer;
            border-radius: 0.5rem;
        }

        .nav-link.active {
            background: var(--primary);
            color: white;
        }

        .view-section {
            display: none;
        }

        .view-section.active {
            display: block;
        }

        /* Login Screen Styles */
        #loginScreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at center, #1e293b 0%, #0f172a 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
        }

        .login-card {
            width: 100%;
            max-width: 400px;
            padding: 3rem;
            text-align: center;
            animation: slideUp 0.6s cubic-bezier(0.16, 1, 0.3, 1);
        }

        .brand-logo {
            width: 64px;
            height: 64px;
            background: var(--primary);
            color: white;
            border-radius: 1.2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1.5rem;
            box-shadow: 0 10px 20px rgba(79, 70, 229, 0.2);
        }

        .brand-name {
            font-size: 1.5rem;
            font-weight: 800;
            margin-bottom: 0.5rem;
            background: linear-gradient(to right, var(--primary), #818cf8);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .login-input-group {
            margin-top: 2rem;
            text-align: left;
        }

        .login-input {
            width: 100%;
            padding: 1rem 1.25rem;
            border: 2px solid var(--border);
            border-radius: 1rem;
            font-size: 1rem;
            transition: all 0.3s ease;
            outline: none;
            margin-bottom: 1.5rem;
            background: rgba(255, 255, 255, 0.8);
            color: #1f2937;
            font-family: sans-serif;
        }

        .login-input:focus {
            border-color: var(--primary);
            background: white;
            box-shadow: 0 0 0 4px rgba(79, 70, 229, 0.1);
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        #adminContent {
            display: none;
        }

        .logo-img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            border-radius: 0.5rem;
        }

        #mainLogoArea img,
        #loginLogoArea img {
            width: 100%;
            height: 100%;
        }
    </style>
</head>

<body>
    <!-- Login Screen -->
    <div id="loginScreen">
        <div class="glass login-card">
            <div class="brand-logo" id="loginLogoArea">
                <i data-lucide="shield-check" style="width: 32px; height: 32px;"></i>
            </div>
            <div class="brand-name" id="loginAppTitle"></div>
            <p style="color: var(--text-muted); font-size: 0.9rem;">ê´€ë¦¬ì ì¸ì¦</p>

            <div class="login-input-group">
                <input type="password" id="adminPasswordInput" class="login-input" placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”"
                    autocomplete="current-password" onkeyup="if(event.key==='Enter') checkAdminLogin()">
                <button class="btn btn-primary" onclick="checkAdminLogin()" style="width: 100%; padding: 1rem;">
                    ëŒ€ì‹œë³´ë“œ ì ‘ì†í•˜ê¸°
                </button>
            </div>
            <p id="loginError" style="color: var(--danger); font-size: 0.85rem; margin-top: 1rem; display: none;">ë¹„ë°€ë²ˆí˜¸ê°€
                ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</p>
        </div>
    </div>

    <script>
        function checkAdminLogin() {
            const input = document.getElementById('adminPasswordInput').value;
            const currentPassword = AttendanceDB.getPassword();

            if (input === currentPassword) {
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('adminContent').style.display = 'block';
                refreshAppTitles(); // ì œëª©ê³¼ ë¡œê³  ë‹¤ì‹œ í™•ì¸
                lucide.createIcons(); // ëŒ€ì‹œë³´ë“œ ì•„ì´ì½˜ ë¡œë“œ
                if (typeof renderAggregatedTable === 'function') renderAggregatedTable();

                // ìë™ ë¡œê·¸ì•„ì›ƒ íƒ€ì´ë¨¸ ì‹œì‘
                resetInactivityTimer();
            } else {
                AudioUtil.playError();
                const error = document.getElementById('loginError');
                error.style.display = 'block';
                // í”ë“¤ë¦¼ íš¨ê³¼ ì• ë‹ˆë©”ì´ì…˜ ì¶”ê°€ ê°€ëŠ¥
            }
        }

        // ì œëª© ë° ë¡œê³  ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function refreshAppTitles() {
            const title = AttendanceDB.getAppTitle();
            const logo = AttendanceDB.getAppLogo();

            const loginTitle = document.getElementById('loginAppTitle');
            const mainTitle = document.getElementById('mainAppTitle');
            if (loginTitle) loginTitle.innerText = title;
            if (mainTitle) mainTitle.innerText = title;
            document.title = `${title} - ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ`;

            // ë¡œê³  ë°˜ì˜
            const loginLogoArea = document.getElementById('loginLogoArea');
            const mainLogoArea = document.getElementById('mainLogoArea');
            const logoHtml = logo ? `<img src="${logo}" class="logo-img">` : `<i data-lucide="shield-check" style="width: 32px; height: 32px;"></i>`;
            const mainLogoHtml = logo ? `<img src="${logo}" class="logo-img" style="width:48px; height:48px; border-radius:0.5rem;">` : '';

            if (loginLogoArea) loginLogoArea.innerHTML = logoHtml;
            if (mainLogoArea) mainLogoArea.innerHTML = mainLogoHtml;

            lucide.createIcons();
        }

        let titleBlinkInterval = null;
        let lastPendingCount = 0;
        let lastTodayCount = 0; // [v2.5.0] ì˜¤ëŠ˜ ì¶œê·¼ë¶€ ì¹´ìš´íŠ¸

        // ì´ˆê¸° ë¡œë“œ ì‹œ ì‹¤í–‰
        window.addEventListener('DOMContentLoaded', async () => {
            // [v2.4.3] ì•Œë¦¼ ê¶Œí•œ ìš”ì²­ (ì„¸ì…˜ ìŠ¤í† ë¦¬ì§€ ì²´í¬ë¡œ F5 ë°˜ë³µ ë°©ì§€)
            if ("Notification" in window && Notification.permission !== "granted") {
                if (!sessionStorage.getItem('notireq_243')) {
                    sessionStorage.setItem('notireq_243', 'true');
                    Notification.requestPermission();
                }
            }

            if (SERVER_CONFIG.useServer) {
                await AttendanceDB.syncSettingsWithServer();
                await refreshNotifications(); // ì´ˆê¸° ìƒíƒœ í™•ì¸

                // [v2.4.2] 60ì´ˆë§ˆë‹¤ ë°ì´í„° í™•ì¸ (ìë™ ê°±ì‹ )
                setInterval(refreshNotifications, 60000);
            }
            refreshAppTitles();
        });

        // [v2.5.0] í†µí•© ì•Œë¦¼ ê°±ì‹  (ìŠ¹ì¸ëŒ€ê¸° + ì¶œê·¼ë¶€ì œì¶œ) - ì†Œë¦¬ ì œê±°ë¨ + [v2.5.1] ì½ìŒ ì²˜ë¦¬
        async function refreshNotifications() {
            if (!SERVER_CONFIG.useServer) return;

            // 1. ìŠ¹ì¸ ëŒ€ê¸° ëª…ë‹¨ ë™ê¸°í™”
            try {
                await AttendanceDB.syncPendingWithServer();
                renderPendingWorkers();
            } catch (e) { console.error("Pending sync failed", e); }

            // 2. ì¶œê·¼ë¶€ ë°ì´í„° ë™ê¸°í™”
            const y = new Date().getFullYear();
            try {
                const res = await fetch(`${SERVER_CONFIG.databaseURL}/records/${y}.json`);
                if (res.ok) {
                    const data = await res.json();
                    if (data) {
                        const records = Array.isArray(data) ? data : Object.values(data);
                        const local = AttendanceDB.getAll();
                        const newRecords = [];
                        records.forEach(r => {
                            if (!local.find(x => x.id === r.id)) newRecords.push(r);
                        });
                        if (newRecords.length > 0) {
                            newRecords.forEach(r => AttendanceDB.save(r, true));
                            renderAggregatedTable();
                        }
                    }
                }
            } catch (e) { console.error("Records sync failed", e); }

            // --- ì•Œë¦¼ ë¡œì§ ë° ë°°ì§€ ì—…ë°ì´íŠ¸ ---
            try {
                const pending = AttendanceDB.getPendingWorkers();
                const pCount = pending.length;

                const today = new Date();
                const todayStr = `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}-${String(today.getDate()).padStart(2, '0')}`;
                const todayRecords = AttendanceDB.getAll().filter(r => r.date === todayStr);
                const tCount = todayRecords.length;

                // [v2.5.1] ì½ìŒ ì²˜ë¦¬ëœ ì¹´ìš´íŠ¸ í™•ì¸
                const viewedCount = parseInt(localStorage.getItem('viewedTodayCount') || '0');
                const badgeCount = Math.max(0, tCount - viewedCount);

                if ("Notification" in window && Notification.permission === "granted") {
                    if (pCount > lastPendingCount) {
                        new Notification("ì‹ ê·œ ì¸ì› ë“±ë¡ ìš”ì²­", { body: `${pCount}ëª…ì˜ ìŠ¹ì¸ ëŒ€ê¸° ì¸ì›ì´ ìˆìŠµë‹ˆë‹¤.` });
                    }
                    // ë°°ì§€ ì¹´ìš´íŠ¸(ì‹ ê·œ ë“±)ê°€ ëŠ˜ì–´ë‚¬ì„ ë•Œë§Œ ì•Œë¦¼
                    if (tCount > lastTodayCount && lastTodayCount > 0) {
                        const diff = tCount - lastTodayCount;
                        new Notification("ì‹ ê·œ ì¶œê·¼ë¶€ ì œì¶œ", { body: `ë°©ê¸ˆ ${diff}ëª…ì´ ì¶”ê°€ë¡œ ì œì¶œí–ˆìŠµë‹ˆë‹¤. (ì˜¤ëŠ˜ ì´ ${tCount}ëª…)` });
                    }
                }

                lastPendingCount = pCount;
                lastTodayCount = tCount;

                updateBadge('navPendingBadge', pCount, 'badge-warning', true);
                // ì›”ê°„ ì§‘ê³„ ë°°ì§€ëŠ” 'ì•ˆ ì½ì€ ê°œìˆ˜'ë§Œ í‘œì‹œ, 0ì´ë©´ ìˆ¨ê¹€
                updateBadge('navTodayBadge', badgeCount, 'badge-success', false);

                if (pCount > 0) {
                    if (!titleBlinkInterval) {
                        let blink = false;
                        titleBlinkInterval = setInterval(() => {
                            document.title = blink ? `ğŸ”´ [${pCount}ëª… ëŒ€ê¸°]` : `âšª ê´€ë¦¬ì í˜ì´ì§€`;
                            blink = !blink;
                        }, 1000);
                    }
                } else {
                    if (titleBlinkInterval) {
                        clearInterval(titleBlinkInterval);
                        titleBlinkInterval = null;
                        refreshAppTitles();
                    }
                }
            } catch (e) { console.error("Badge update failed", e); }
        }

        function updateBadge(id, count, colorClass, blink) {
            const el = document.getElementById(id);
            if (!el) return;
            if (count > 0) {
                el.innerText = count;
                el.style.display = 'inline-block';
                el.className = `badge ${colorClass} ${blink ? 'badge-blink' : ''}`;
            } else {
                el.style.display = 'none';
                el.classList.remove('badge-blink');
            }
        }

        // [v2.5.1] ì½ìŒ ì²˜ë¦¬ í•¨ìˆ˜
        function markAsReadToday() {
            const today = new Date();
            const todayStr = `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}-${String(today.getDate()).padStart(2, '0')}`;
            const todayRecords = AttendanceDB.getAll().filter(r => r.date === todayStr);
            const count = todayRecords.length;

            localStorage.setItem('viewedTodayCount', count.toString());
            // ë°°ì§€ ì¦‰ì‹œ ìˆ¨ê¹€
            updateBadge('navTodayBadge', 0, 'badge-success', false);
        }
    </script>
    <div id="adminContent">
        <div class="container no-print">
            <header class="fade-in"
                style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                <div style="display: flex; align-items: center; gap: 1rem;">
                    <div id="mainLogoArea"></div>
                    <div>
                        <h1 id="mainAppTitle" style="margin-bottom:0.2rem;">í”„ë¦¬ë¯¸ì—„ ê·¼íƒœ ê´€ë¦¬</h1>
                        <p style="color: var(--text-muted);">í†µê³„, ì¸ì› ê´€ë¦¬ ë° ì¼ê´„ ë¦¬í¬íŠ¸ ì¶œë ¥</p>
                    </div>
                </div>
            </header>

            <nav class="nav-tabs fade-in">
                <div class="nav-link active" onclick="showSection('aggView', this); markAsReadToday()">
                    ì›”ê°„ ì§‘ê³„ <span id="navTodayBadge" class="badge badge-success"
                        style="display:none; margin-left:6px; font-size:0.7rem; vertical-align:middle;">0</span>
                </div>
                <div class="nav-link" onclick="showSection('annualView', this)">íšŒê¸° ì§‘ê³„</div>
                <div class="nav-link" onclick="showSection('workerView', this)">
                    ì¸ì› ê´€ë¦¬ <span id="navPendingBadge" class="badge badge-warning"
                        style="display:none; margin-left:6px; font-size:0.7rem; vertical-align:middle;">0</span>
                </div>
                <div class="nav-link" onclick="showSection('noticeView', this)">ê³µì§€ì‚¬í•­</div>
                <div class="nav-link" onclick="showSection('holidayView', this)">íœ´ì¼ ê´€ë¦¬</div>
                <div class="nav-link" onclick="showSection('settingsView', this)" style="margin-left:auto;">
                    <i data-lucide="settings" style="width:16px;"></i> ì„¤ì •
                </div>
            </nav>

            <!-- Aggregated View Section -->
            <div id="aggView" class="view-section active fade-in">
                <div class="stats-grid"
                    style="grid-template-columns: 1fr 2fr; gap: 1.5rem; margin-bottom: 2rem; align-items: stretch;">
                    <!-- ì „ì²´ ì œì¶œ í˜„í™© ì¹´ë“œ -->
                    <div class="glass stat-card"
                        style="display: flex; flex-direction: column; justify-content: center; padding: 2.5rem; border-left: 6px solid var(--primary); min-height: 220px;">
                        <div class="stat-value" id="statsTotal" style="font-size: 3.5rem; margin-bottom: 0.5rem;">0 / 0
                        </div>
                        <div class="stat-label" style="font-size: 1.2rem; font-weight: 800; color: var(--primary);">ì „ì²´
                            ì œì¶œ í˜„í™©</div>
                        <p style="color: var(--text-muted); font-size: 0.9rem; margin-top: 1rem;">í˜„ì¬ ì„ íƒëœ ì›”ì˜ ì´ ì œì¶œ ì¸ì›ì…ë‹ˆë‹¤.
                        </p>
                    </div>

                    <!-- ë³´ì§ë³„ ìƒì„¸ í˜„í™© ì¹´ë“œ -->
                    <div class="glass stat-card" style="padding: 2rem; min-height: 220px;">
                        <div
                            style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 1.5rem; border-bottom: 1px solid #eee; padding-bottom: 0.8rem;">
                            <i data-lucide="users" style="width: 20px; color: var(--secondary);"></i>
                            <h3 style="margin:0; font-size: 1.2rem;">ê·¼ë¬´ í˜•íƒœë³„ ìƒì„¸ ì œì¶œ í˜„í™©</h3>
                        </div>
                        <div
                            style="display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 1rem;">
                            <div
                                style="background: #f8fafc; padding: 1rem; border-radius: 12px; border: 1px solid #edf2f7;">
                                <div
                                    style="font-size: 0.8rem; color: var(--text-muted); font-weight: 600; margin-bottom: 0.4rem;">
                                    1. ê¸°ê°„ê·¼ë¬´ì</div>
                                <div id="statsType1"
                                    style="font-size: 1.4rem; font-weight: 800; color: var(--secondary);">0 / 0</div>
                            </div>
                            <div
                                style="background: #f8fafc; padding: 1rem; border-radius: 12px; border: 1px solid #edf2f7;">
                                <div
                                    style="font-size: 0.8rem; color: var(--text-muted); font-weight: 600; margin-bottom: 0.4rem;">
                                    2. ìƒì‹œ(ë°©í•™ë¹„)</div>
                                <div id="statsType2"
                                    style="font-size: 1.4rem; font-weight: 800; color: var(--secondary);">0 / 0</div>
                            </div>
                            <div
                                style="background: #f8fafc; padding: 1rem; border-radius: 12px; border: 1px solid #edf2f7;">
                                <div
                                    style="font-size: 0.8rem; color: var(--text-muted); font-weight: 600; margin-bottom: 0.4rem;">
                                    3. ìƒì‹œê·¼ë¬´</div>
                                <div id="statsType3"
                                    style="font-size: 1.4rem; font-weight: 800; color: var(--secondary);">0 / 0</div>
                            </div>
                            <div
                                style="background: #f8fafc; padding: 1rem; border-radius: 12px; border: 1px solid #edf2f7;">
                                <div
                                    style="font-size: 0.8rem; color: var(--text-muted); font-weight: 600; margin-bottom: 0.4rem;">
                                    4. ë°©í•™ì¤‘ê·¼ë¬´</div>
                                <div id="statsType4"
                                    style="font-size: 1.4rem; font-weight: 800; color: var(--secondary);">0 / 0</div>
                            </div>
                            <div
                                style="background: #f8fafc; padding: 1rem; border-radius: 12px; border: 1px solid #edf2f7;">
                                <div
                                    style="font-size: 0.8rem; color: var(--text-muted); font-weight: 600; margin-bottom: 0.4rem;">
                                    5. ê·¸ì™¸</div>
                                <div id="statsType5"
                                    style="font-size: 1.4rem; font-weight: 800; color: var(--secondary);">0 / 0</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="glass"
                    style="padding: 1.5rem; margin-bottom: 2rem; display: flex; gap: 1rem; align-items: flex-end;">
                    <div style="flex: 2;">
                        <label>ì´ë¦„ ê²€ìƒ‰</label>
                        <input type="text" id="filterName" placeholder="ì„±ëª…ì„ ì…ë ¥í•˜ì„¸ìš”" oninput="renderAggregatedTable()">
                    </div>
                    <div style="flex: 1;">
                        <label>ì¡°íšŒ ì›” ì„ íƒ</label>
                        <input type="month" id="filterMonth" onchange="renderAggregatedTable()">
                    </div>
                    <div style="display: flex; gap: 0.5rem;">
                        <button id="syncBtn" class="btn btn-secondary" onclick="syncServer()"
                            style="color: var(--success);">
                            <i data-lucide="refresh-cw"></i> ì„œë²„ ë™ê¸°í™”
                        </button>
                        <button class="btn btn-secondary" onclick="importFromMessage()" style="color: var(--primary);">
                            <i data-lucide="import"></i> ë¶™ì—¬ë„£ê¸° ì§‘ê³„
                        </button>
                        <button class="btn btn-primary" onclick="printAll()">
                            <i data-lucide="printer"></i> ëª¨ë‘ ì¶œë ¥
                        </button>
                    </div>
                </div>

                <div class="glass" style="padding: 1.5rem;">
                    <table id="summaryTable">
                        <thead>
                            <tr>
                                <th>ë²ˆí˜¸</th>
                                <th>ì„±ëª…</th>
                                <th>í•´ë‹¹ ì›”</th>
                                <th>ì´ ê·¼ë¬´ì¼ìˆ˜</th>
                                <th>ìµœê·¼ ì „ì†¡ì¼</th>
                                <th>ë¦¬í¬íŠ¸</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>

            <!-- Annual Summary Section -->
            <div id="annualView" class="view-section fade-in">
                <div class="glass"
                    style="padding: 1.5rem; margin-bottom: 2rem; display: flex; justify-content: space-between; align-items: flex-end;">
                    <div style="display: flex; gap: 1rem; flex: 1; align-items: flex-end;">
                        <div style="flex: 1; max-width: 250px;">
                            <label>íšŒê¸° ë°ì´í„° ì„ íƒ</label>
                            <select id="fiscalYearSelect" class="btn btn-secondary" style="width:100%; text-align:left;"
                                onchange="switchFiscalYear()">
                                <!-- ìŠ¤í¬ë¦½íŠ¸ì—ì„œ ìë™ ìƒì„±ë¨ -->
                            </select>
                        </div>
                        <div style="color: var(--text-muted); font-size: 0.85rem; margin-bottom: 0.5rem;">
                            * í•™êµ íšŒê¸° ê¸°ì¤€(3ì›” ~ ìµë…„ 2ì›”)ìœ¼ë¡œ ì§‘ê³„ë©ë‹ˆë‹¤.
                        </div>
                    </div>
                    <button class="btn btn-primary" onclick="printAnnualReport()">
                        <i data-lucide="printer"></i> íšŒê¸° ë¦¬í¬íŠ¸ ì¸ì‡„
                    </button>
                </div>
                <div class="glass" style="padding: 1.5rem; overflow-x: auto;">
                    <table id="annualTable" style="min-width: 800px;">
                        <thead>
                            <tr>
                                <th>ì„±ëª…</th>
                                <th>3ì›”</th>
                                <th>4ì›”</th>
                                <th>5ì›”</th>
                                <th>6ì›”</th>
                                <th>7ì›”</th>
                                <th>8ì›”</th>
                                <th>9ì›”</th>
                                <th>10ì›”</th>
                                <th>11ì›”</th>
                                <th>12ì›”</th>
                                <th>1ì›”</th>
                                <th>2ì›”</th>
                                <th style="background:#f8fafc;">ë¹„ê³ </th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>

            <!-- Worker Management Section -->
            <div id="workerView" class="view-section fade-in">

                <!-- [v2.3.0] ìŠ¹ì¸ ëŒ€ê¸° ëª©ë¡ (ë°ì´í„° ìˆì„ ë•Œë§Œ í‘œì‹œ) -->
                <div id="pendingSection" style="margin-bottom: 2rem; display: none;">
                    <div class="glass" style="padding: 1.5rem; border: 2px solid var(--secondary);">
                        <h3
                            style="color: var(--secondary); margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                            <i data-lucide="user-check"></i> ìŠ¹ì¸ ëŒ€ê¸° ì¸ì›
                            <span id="pendingCount" class="badge badge-warning"
                                style="background: var(--secondary); color: white;">0ëª…</span>
                        </h3>
                        <div style="overflow-x: auto;">
                            <table id="pendingTable">
                                <thead>
                                    <tr>
                                        <th>ì‹ ì²­ì¼ì‹œ</th>
                                        <th>ì´ë¦„</th>
                                        <th>ìƒë…„ì›”ì¼</th>
                                        <th>ì „í™”ë²ˆí˜¸</th>
                                        <th>ì‘ì—…</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div class="glass"
                    style="padding: 1.5rem; margin-bottom: 2rem; display: flex; justify-content: space-between; align-items: center;">
                    <h2>ë“±ë¡ëœ ì¸ì› ëª©ë¡</h2>
                    <div style="display: flex; gap: 1rem; align-items: center;">
                        <div style="display: flex; gap: 0.5rem;">
                            <button class="btn btn-primary" onclick="copyAttendanceLink()">
                                <i data-lucide="copy"></i> ì¶œê·¼ë¶€ ì‘ì„±
                            </button>
                            <button class="btn btn-secondary" onclick="openWorkerModal()">
                                <i data-lucide="user-plus"></i> ìƒˆ ì¸ì› ë“±ë¡
                            </button>
                        </div>
                        <div style="display: flex; gap: 0.8rem;">
                            <!-- [v2.5.3] ì¼ê´„ ì‚­ì œ ë²„íŠ¼ ì¶”ê°€ -->
                            <button class="btn btn-danger" onclick="deleteSelectedWorkers()"
                                style="display: flex; align-items: center; gap: 0.4rem;">
                                <i data-lucide="trash-2"></i> ì„ íƒ ì¸ì› ì‚­ì œ
                            </button>
                            <button class="btn btn-secondary" onclick="triggerExcelUpload()"
                                style="display: flex; align-items: center; gap: 0.4rem;">
                                <i data-lucide="file-up"></i> ğŸ“¥ ëª…ë‹¨ ì¼ê´„ ë“±ë¡
                            </button>
                            <input type="file" id="workerExcelInput" style="display: none;" accept=".xlsx, .xls"
                                onchange="handleExcelUpload(event)">
                            <button class="btn btn-secondary" onclick="exportWorkersExcel()"
                                style="display: flex; align-items: center; gap: 0.4rem;">
                                <i data-lucide="file-down"></i> ğŸ“¤ ëª…ë‹¨ íŒŒì¼ ì €ì¥
                            </button>
                        </div>
                    </div>
                </div>
                <div class="glass" style="padding: 1.5rem;">
                    <table id="workerTable">
                        <thead>
                            <tr>
                                <th><input type="checkbox" id="selectAllWorkers" onclick="toggleAllWorkers(this)"></th>
                                <th>ì´ë¦„</th>
                                <th>ì „í™”ë²ˆí˜¸</th>
                                <th>êµ¬ë¶„</th>
                                <th>ì£¼ì†Œ</th>
                                <th>ë¹„ê³ </th>
                                <th>ì‘ì—…</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>

            <!-- [v2.2.0] Notice Management Section -->
            <div id="noticeView" class="view-section fade-in">
                <div class="glass" style="padding: 2.5rem;">
                    <h2 style="margin-bottom: 0.5rem; display: flex; align-items: center; gap: 0.8rem;">
                        <i data-lucide="megaphone" style="color: var(--secondary);"></i> ì§ì› ê³µì§€ì‚¬í•­ ì„¤ì •
                    </h2>
                    <p style="color: var(--text-muted); margin-bottom: 2rem;">
                        ì—¬ê¸°ì— ì‘ì„±í•œ ë‚´ìš©ì€ ì§ì›ìš© í˜ì´ì§€(`worker.html`) ìƒë‹¨ì— ì¦‰ì‹œ í‘œì‹œë©ë‹ˆë‹¤.
                    </p>

                    <div style="margin-bottom: 2rem;">
                        <textarea id="noticeTextArea" class="btn btn-secondary"
                            style="width: 100%; min-height: 250px; text-align: left; padding: 1.5rem; font-size: 1.1rem; line-height: 1.6; cursor: text; background: var(--surface); border: 2px solid var(--border); color: var(--text);"
                            placeholder="ì§ì›ë“¤ì—ê²Œ ì•Œë¦´ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
                    </div>

                    <div style="display: flex; justify-content: flex-end; gap: 1rem;">
                        <button class="btn btn-secondary" onclick="document.getElementById('noticeTextArea').value=''">
                            <i data-lucide="trash-2"></i> ë‚´ìš© ì§€ìš°ê¸°
                        </button>
                        <button class="btn btn-primary" onclick="updateNotice()" style="padding: 1rem 3rem;">
                            <i data-lucide="save"></i> ê³µì§€ì‚¬í•­ ì €ì¥ ë° ê²Œì‹œ
                        </button>
                    </div>
                </div>
            </div>

            <!-- Holiday Management Section -->
            <div id="holidayView" class="view-section fade-in">
                <div class="glass" style="padding: 1.5rem; margin-bottom: 2rem;">
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <div>
                            <h2>íœ´ì¼ ê´€ë¦¬</h2>
                            <p style="color: var(--text-muted);">ë‚ ì§œë¥¼ í´ë¦­í•˜ì—¬ íœ´ì¼ ë˜ëŠ” í•™êµ ì¬ëŸ‰ íœ´ì—…ì¼ì„ ì§€ì •/í•´ì œí•˜ì„¸ìš”.</p>
                            <div style="display: flex; gap: 1rem; margin-top: 0.5rem; font-size: 0.8rem;">
                                <div style="display: flex; align-items: center; gap: 4px;">
                                    <div style="width: 12px; height: 12px; background: #ff5f5f; border-radius: 2px;">
                                    </div>
                                    <span>íœ´ì¼ (ë¹¨ê°„ìƒ‰)</span>
                                </div>
                                <div style="display: flex; align-items: center; gap: 4px;">
                                    <div
                                        style="width: 12px; height: 12px; background: #d1fae5; border-radius: 2px; border: 1px solid #34d399;">
                                    </div>
                                    <span style="color: #059669;">ë°©í•™ ê¸°ê°„ (ì´ˆë¡ìƒ‰)</span>
                                </div>
                                <div style="display: flex; align-items: center; gap: 4px;">
                                    <div
                                        style="width: 12px; height: 12px; background: white; border-radius: 2px; border: 2px solid var(--primary);">
                                    </div>
                                    <span style="color: var(--primary); font-weight: 700;">ë°©í•™ ì¤‘ ì¶œê·¼ì¼ (í…Œë‘ë¦¬ ë³´ë¼)</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="input-group" style="max-width: 300px; margin-bottom: 2rem;">
                        <label>ê´€ë¦¬í•  ì›” ì„ íƒ</label>
                        <input type="month" id="holidayMonth" onchange="renderHolidayCalendar()">
                    </div>

                    <div class="weekday-row"
                        style="display: grid; grid-template-columns: repeat(7, 1fr); text-align: center; font-weight: bold; margin-bottom: 0.5rem;">
                        <div style="color: var(--danger);">ì¼</div>
                        <div>ì›”</div>
                        <div>í™”</div>
                        <div>ìˆ˜</div>
                        <div>ëª©</div>
                        <div>ê¸ˆ</div>
                        <div style="color: var(--primary);">í† </div>
                    </div>
                    <div id="holidayCalendarGrid" class="calendar-grid"></div>
                </div>
            </div>

            <!-- Settings Section -->
            <div id="settingsView" class="view-section fade-in">
                <div class="glass" style="padding: 2rem; margin: 0 auto;">
                    <h2 style="margin-bottom: 2rem;"><i data-lucide="settings"></i> ì‹œìŠ¤í…œ ì„¤ì •</h2>

                    <div style="margin-bottom: 3rem; padding-bottom: 2rem; border-bottom: 1px solid var(--border);">
                        <h3>ë¡œê³  ì´ë¯¸ì§€ ì„¤ì •</h3>
                        <p style="color:var(--text-muted); font-size:0.9rem; margin-bottom:1rem;">ë¡œê·¸ì¸ í™”ë©´ê³¼ ëŒ€ì‹œë³´ë“œ ìƒë‹¨ì— í‘œì‹œë 
                            ë¡œê³ ë¥¼ ë³€ê²½í•©ë‹ˆë‹¤.</p>
                        <div style="display:flex; align-items:center; gap:1.5rem;">
                            <div id="logoPreview" class="glass"
                                style="width:80px; height:80px; display:flex; align-items:center; justify-content:center; overflow:hidden; background:white;">
                                <i data-lucide="image" style="color:#ccc;"></i>
                            </div>
                            <div style="flex:1;">
                                <input type="file" id="logoInput" accept="image/*" style="display:none;"
                                    onchange="updateAppLogo(this)">
                                <button class="btn btn-secondary"
                                    onclick="document.getElementById('logoInput').click()">ì´ë¯¸ì§€ ì„ íƒ</button>
                                <button class="btn btn-secondary" onclick="resetAppLogo()"
                                    style="color:var(--danger);">ì´ˆê¸°í™”</button>
                            </div>
                        </div>
                    </div>

                    <div style="margin-bottom: 3rem; padding-bottom: 2rem; border-bottom: 1px solid var(--border);">
                        <h3>ì•± ì´ë¦„ ì„¤ì •</h3>
                        <p style="color:var(--text-muted); font-size:0.9rem; margin-bottom:1rem;">ëŒ€ì‹œë³´ë“œ ìƒë‹¨ ë° ë¡œê·¸ì¸ í™”ë©´ì— í‘œì‹œë 
                            ì´ë¦„ì„ ìˆ˜ì •í•©ë‹ˆë‹¤.</p>
                        <div style="display:flex; gap:0.5rem; align-items:stretch;">
                            <input type="text" id="appTitleInput" placeholder="ì˜ˆ: ìš°ë¦¬íšŒì‚¬ ê·¼íƒœê´€ë¦¬" class="btn btn-secondary"
                                style="flex:1; text-align:left; cursor:text; color: var(--primary); font-size: 1.2rem; font-weight: 800; border: 2px solid var(--primary); background: #f8fafc; padding: 0.8rem 1rem;">
                            <button class="btn btn-primary" onclick="updateAppTitle()" style="min-width:120px;">ì´ë¦„
                                ë³€ê²½</button>
                        </div>
                    </div>

                    <div style="margin-bottom: 3rem; padding-bottom: 2rem; border-bottom: 1px solid var(--border);">
                        <h3>ìë™ ë¡œê·¸ì•„ì›ƒ ì„¤ì •</h3>
                        <p style="color:var(--text-muted); font-size:0.9rem; margin-bottom:1rem;">ì¥ì‹œê°„ í™œë™ì´ ì—†ì„ ê²½ìš° ìë™ìœ¼ë¡œ
                            ì´ˆê¸°í™”ë©´ìœ¼ë¡œ ëŒì•„ê°‘ë‹ˆë‹¤. (0 ì…ë ¥ ì‹œ ë¹„í™œì„±í™”)</p>
                        <div style="display:flex; gap:0.5rem; align-items:center;">
                            <input type="number" id="autoLogoutInput" placeholder="10" class="btn btn-secondary"
                                style="width:120px; text-align:center; cursor:text; color: var(--primary); font-size: 1.5rem; font-weight: 900; border: 2px solid var(--primary); background: #f8fafc;">
                            <span style="font-weight:600;">ë¶„ í›„ ë¡œê·¸ì•„ì›ƒ</span>
                            <button class="btn btn-primary" onclick="updateAutoLogoutTime()"
                                style="margin-left:auto;">ì„¤ì • ì €ì¥</button>
                        </div>
                    </div>

                    <div style="margin-bottom: 3rem; padding-bottom: 2rem; border-bottom: 1px solid var(--border);">
                        <h3>ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</h3>
                        <p style="color:var(--text-muted); font-size:0.9rem; margin-bottom:1rem;">ëŒ€ì‹œë³´ë“œ ì ‘ì† ì‹œ ì‚¬ìš©í•˜ëŠ” ë¹„ë°€ë²ˆí˜¸ë¥¼
                            ìˆ˜ì •í•©ë‹ˆë‹¤.</p>
                        <div style="display:flex; gap:0.5rem; align-items:stretch;">
                            <input type="password" id="newPassword" placeholder="ìƒˆ ë¹„ë°€ë²ˆí˜¸ ì…ë ¥" class="btn btn-secondary"
                                autocomplete="off"
                                style="flex:1; text-align:left; cursor:text; color: var(--primary); font-size: 1.2rem; font-weight: 800; border: 2px solid var(--primary); background: #f8fafc; padding: 0.8rem 1rem;">
                            <button class="btn btn-primary" onclick="updatePassword()" style="min-width:120px;">ë³€ê²½
                                ì €ì¥</button>
                        </div>
                    </div>

                    <div style="margin-bottom: 3rem; padding-bottom: 2rem; border-bottom: 1px solid var(--border);">
                        <h3>ì¶œê·¼ë¶€ ì œì¶œ ê¸°í•œ ì„¤ì •</h3>
                        <p style="color:var(--text-muted); font-size:0.9rem; margin-bottom:1rem;">ì§ì›ë“¤ì—ê²Œ ë³´ë‚¼ ì•ˆë‚´ ë¬¸êµ¬ì— í¬í•¨ë  ì œì¶œ
                            ê¸°í•œì„ ì„¤ì •í•©ë‹ˆë‹¤.</p>
                        <div style="display:flex; gap:0.5rem; align-items:stretch;">
                            <input type="text" id="deadlineInput" placeholder="ì˜ˆ: ë§¤ì›” 5ì¼" class="btn btn-secondary"
                                style="flex:1; text-align:left; cursor:text; color: var(--primary); font-size: 1.2rem; font-weight: 800; border: 2px solid var(--primary); background: #f8fafc; padding: 0.8rem 1rem;">
                            <button class="btn btn-primary" onclick="updateDeadline()" style="min-width:120px;">ê¸°í•œ
                                ì„¤ì •</button>
                        </div>
                    </div>

                    <div style="margin-bottom: 3rem; padding-bottom: 2rem; border-bottom: 1px solid var(--border);">
                        <h3>ë°©í•™ ê¸°ê°„ ì„¤ì • (v1.7)</h3>
                        <p style="color:var(--text-muted); font-size:0.9rem; margin-bottom:1rem;">ì—¬ë¦„ ë° ê²¨ìš¸ ë°©í•™ ê¸°ê°„ì„ ì„¤ì •í•˜ë©´
                            ê·¼ë¬´í˜•íƒœì— ë”°ë¼ ì¶œê·¼ ê°€ëŠ¥ì¼ì´ ìë™ ì¡°ì •ë©ë‹ˆë‹¤.</p>

                        <div
                            style="display:grid; grid-template-columns: repeat(3, 1fr); gap:1.25rem; margin-bottom:1.5rem;">
                            <div class="glass" style="padding:1.25rem;">
                                <h4 style="margin-bottom:0.8rem; color:#818cf8;"><i data-lucide="sun"
                                        style="width:16px;"></i> ì—¬ë¦„ ë°©í•™</h4>
                                <div class="input-group">
                                    <label>ì‹œì‘ì¼</label>
                                    <input type="date" id="vacSStart" class="btn btn-secondary"
                                        style="width:100%; text-align:left;">
                                </div>
                                <div class="input-group">
                                    <label>ì¢…ë£Œì¼</label>
                                    <input type="date" id="vacSEnd" class="btn btn-secondary"
                                        style="width:100%; text-align:left;">
                                </div>
                            </div>
                            <div class="glass" style="padding:1.25rem;">
                                <h4 style="margin-bottom:0.8rem; color:#60a5fa;"><i data-lucide="snowflake"
                                        style="width:16px;"></i> ê²¨ìš¸ ë°©í•™</h4>
                                <div class="input-group">
                                    <label>ì‹œì‘ì¼</label>
                                    <input type="date" id="vacWStart" class="btn btn-secondary"
                                        style="width:100%; text-align:left;">
                                </div>
                                <div class="input-group">
                                    <label>ì¢…ë£Œì¼</label>
                                    <input type="date" id="vacWEnd" class="btn btn-secondary"
                                        style="width:100%; text-align:left;">
                                </div>
                            </div>
                            <!-- ë´„ë°©í•™ ì¶”ê°€ (v1.8.5) -->
                            <div class="glass" style="padding:1.25rem;">
                                <h4 style="margin-bottom:0.8rem; color:#34d399;"><i data-lucide="flower"
                                        style="width:16px;"></i> ë´„ ë°©í•™</h4>
                                <div class="input-group">
                                    <label>ì‹œì‘ì¼</label>
                                    <input type="date" id="vacPStart" class="btn btn-secondary"
                                        style="width:100%; text-align:left;">
                                </div>
                                <div class="input-group">
                                    <label>ì¢…ë£Œì¼</label>
                                    <input type="date" id="vacPEnd" class="btn btn-secondary"
                                        style="width:100%; text-align:left;">
                                </div>
                            </div>
                        </div>
                        <button class="btn btn-primary" onclick="updateVacationSettings()" style="width:100%;">ë°©í•™ ê¸°ê°„
                            ì €ì¥</button>
                    </div>

                    <!-- ì†Œë¦¬ ì•Œë¦¼ ì„¤ì • (v1.8.9) -->
                    <div style="margin-bottom: 3rem; padding-bottom: 2rem; border-bottom: 1px solid var(--border);">
                        <h3>ì•Œë¦¼ ì†Œë¦¬ ì„¤ì •</h3>
                        <p style="color:var(--text-muted); font-size:0.9rem; margin-bottom:1rem;">ì¤‘ìš” ì•Œë¦¼ì´ë‚˜ ì„±ê³µ/ì˜¤ë¥˜ ë°œìƒ ì‹œ
                            íš¨ê³¼ìŒì„ ì¬ìƒí•©ë‹ˆë‹¤.</p>
                        <div style="display:flex; align-items:center; gap:1rem;">
                            <button id="soundToggleBtn" class="btn btn-secondary" onclick="toggleSoundSetting()"
                                style="display:flex; align-items:center; gap:0.5rem; min-width:140px; justify-content:center;">
                                <i data-lucide="volume-2"></i> <span>ì†Œë¦¬ ì¼œì§</span>
                            </button>
                            <span id="soundStatusText"
                                style="font-size:0.9rem; font-weight:600; color:var(--primary);">ì•Œë¦¼ ì†Œë¦¬ê°€ í™œì„±í™”ë˜ì–´
                                ìˆìŠµë‹ˆë‹¤.</span>
                        </div>
                    </div>

                    <!-- [v2.0.0] íšŒê¸°ë…„ë„ ì•„ì¹´ì´ë¹™ (New) -->
                    <div style="margin-bottom: 3rem; padding-bottom: 2rem; border-bottom: 1px solid var(--border);">
                        <h3><i data-lucide="archive"></i> íšŒê¸°ë…„ë„ ì•„ì¹´ì´ë¹™</h3>
                        <p style="color:var(--text-muted); font-size:0.9rem; margin-bottom:1rem;">
                            ìƒˆë¡œìš´ íšŒê¸°ê°€ ì‹œì‘ë˜ë©´ ì´ì „ 1ë…„ì¹˜ ë°ì´í„°ë¥¼ <b>ì—‘ì…€ ë°±ì—… í›„ ë¡œì»¬ì—ì„œ ë¹„ì›Œì¤Œ</b>ìœ¼ë¡œì¨ ì•± ì†ë„ë¥¼ ìµœì í™”í•©ë‹ˆë‹¤.
                        </p>
                        <div class="glass"
                            style="padding:1.5rem; border: 1px solid var(--primary); background: rgba(var(--primary-rgb), 0.05);">
                            <div
                                style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                                <div>
                                    <h4 style="color: var(--primary); margin-bottom: 0.2rem;">ìˆ˜ë™ ì•„ì¹´ì´ë¹™ ì‹¤í–‰</h4>
                                    <span style="font-size: 0.8rem; color: var(--text-muted);">í˜„ì¬ ë¡œì»¬ ë°ì´í„°ë¥¼ ëª¨ë‘ ë°±ì—…í•˜ê³ 
                                        ì´ˆê¸°í™”í•©ë‹ˆë‹¤.</span>
                                </div>
                                <div id="currentFiscalInfo" style="font-weight: 800; font-size: 1.2rem;">
                                    <!-- JSë¡œ 0000ë…„ í‘œì‹œ -->
                                </div>
                            </div>
                            <button class="btn btn-primary" onclick="confirmManualArchive()" style="width: 100%;">
                                <i data-lucide="save"></i> ë°ì´í„° ë°±ì—… ë° ì•± ìµœì í™” (Archive)
                            </button>
                        </div>
                    </div>

                    <div style="margin-bottom: 2rem;">
                        <h3>ë°ì´í„° ì´ˆê¸°í™”</h3>
                        <p style="color:var(--danger); font-size:0.9rem; margin-bottom:1.5rem;">âš ï¸ ì´ˆê¸°í™”ëœ ë°ì´í„°ëŠ” ë³µêµ¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
                            ì‹ ì¤‘í•˜ê²Œ ì„ íƒí•˜ì„¸ìš”.</p>

                        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:1rem;">
                            <div class="glass" style="padding:1.5rem; text-align:center; border:1px solid #fee2e2;">
                                <h4 style="margin-bottom:0.5rem;">ë°ì´í„° ë¡œì»¬ ì´ˆê¸°í™”</h4>
                                <p style="font-size:0.8rem; color:var(--text-muted); margin-bottom:1rem;">PC(ë¸Œë¼ìš°ì €)ì— ì €ì¥ëœ
                                    í˜„ì¬ íšŒê¸° ë°ì´í„°ë¥¼ ë¹„ì›ë‹ˆë‹¤. ì„œë²„ ë°ì´í„°ëŠ” ìœ ì§€ë©ë‹ˆë‹¤.</p>
                                <button class="btn btn-secondary" onclick="clearLocalRecords()"
                                    style="color:var(--danger); width:100%;">ë¡œì»¬ ì €ì¥ì†Œ ë¹„ìš°ê¸°</button>
                            </div>
                            <div class="glass" style="padding:1.5rem; text-align:center; border:1px solid #fee2e2;">
                                <h4 style="margin-bottom:0.5rem;">ì„œë²„ ë°ì´í„° ì˜êµ¬ ì‚­ì œ</h4>
                                <p style="font-size:0.8rem; color:var(--text-muted); margin-bottom:1rem;">ì„ íƒëœ íšŒê¸°ì˜ ì„œë²„
                                    ë°ì´í„°ë¥¼ ì˜êµ¬íˆ ì‚­ì œí•©ë‹ˆë‹¤.</p>
                                <button class="btn btn-secondary" onclick="clearServerRecords()"
                                    style="color:var(--danger); width:100%;">ì„œë²„ ë°ì´í„° ì´ˆê¸°í™”</button>
                            </div>
                        </div>
                    </div>

                    <!-- [v2.0.0] íšŒê¸°ë…„ë„ ê´€ë¦¬ ê°€ì´ë“œ -->
                    <div class="glass"
                        style="padding: 2rem; border-left: 6px solid var(--secondary); margin-top: 2rem;">
                        <h3>ğŸ’¾ ë°ì´í„° ë³´ê´€ ë° íšŒê¸° ê´€ë¦¬ ê°€ì´ë“œ</h3>
                        <p style="color: var(--text-muted); font-size: 0.9rem; margin: 1rem 0;">
                            í•™êµ íšŒê¸°ë…„ë„(3ì›”~2ì›”)ê°€ ì¢…ë£Œë˜ë©´ ë°ì´í„°ë¥¼ ë‚´ PCì— ì•ˆì „í•˜ê²Œ ë³´ê´€í•˜ê³  ë‹¤ìŒ íšŒê¸°ë¥¼ ì¤€ë¹„í•˜ì„¸ìš”.<br>
                            <b>ì§€ì • ë°±ì—… ìœ„ì¹˜: [ë‚´ PCì˜ ë‹¤ìš´ë¡œë“œ í´ë”]</b>
                        </p>
                        <ul style="color: var(--text-muted); font-size: 0.85rem; line-height: 1.6;">
                            <li>1. ì—°ê°„ ì§‘ê³„ íƒ­ì—ì„œ í•´ë‹¹ íšŒê¸°ì˜ <b>'ëª…ë‹¨ íŒŒì¼ ë‚´ë³´ë‚´ê¸°'</b>ë¡œ Excelì„ ì €ì¥í•˜ì„¸ìš”.</li>
                            <li>2. ìœ„ 'ë°ì´í„° ë¡œì»¬ ì´ˆê¸°í™”'ë¥¼ í´ë¦­í•˜ì—¬ ë¸Œë¼ìš°ì € ìš©ëŸ‰ì„ í™•ë³´í•˜ì„¸ìš”.</li>
                            <li>3. í•„ìš” ì‹œ 'íšŒê¸° ë°ì´í„° ì „í™˜' ë©”ë‰´ë¥¼ í†µí•´ ê³¼ê±° ê¸°ë¡ì„ ì„œë²„ì—ì„œ ë‹¤ì‹œ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- Worker Add Modal (v1.7.3 ìµœì í™”) -->
        <div id="workerModal" class="modal-overlay" onclick="closeWorkerModal(event)">
            <div class="glass modal-content" onclick="event.stopPropagation()"
                style="max-width: 800px; width: 95%; max-height: 90vh; overflow-y: auto; padding: 2rem;">
                <h2 style="margin-bottom: 1.5rem;">ì¸ì› ë“±ë¡</h2>
                <form id="workerForm" onsubmit="saveWorker(event)">
                    <input type="hidden" id="wId">
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1.25rem;">
                        <div class="input-group">
                            <label>ì„±ëª…</label>
                            <input type="text" id="wName" required
                                style="padding: 0.8rem; border: 1px solid var(--border); border-radius: 8px;">
                        </div>
                        <div class="input-group">
                            <label>ì „í™”ë²ˆí˜¸</label>
                            <input type="text" id="wPhone" placeholder="010-0000-0000"
                                style="padding: 0.8rem; border: 1px solid var(--border); border-radius: 8px;">
                        </div>
                        <div class="input-group">
                            <label style="color:var(--primary); font-weight:700;">ê·¼ë¬´í˜•íƒœ ì„ íƒ</label>
                            <select id="wWorkType"
                                style="width:100%; padding:0.8rem; border: 2px solid var(--primary); border-radius: 8px; background: white; color: black; font-weight: 600; cursor: pointer;"
                                onchange="handleWorkTypeChange(this.value)">
                                <option value="ê¸°ê°„ê·¼ë¬´">1. ê¸°ê°„ê·¼ë¬´ (í•™ê¸°ì¤‘)</option>
                                <option value="ìƒì‹œ(ë°©í•™ë¹„ê·¼ë¬´)">2. ìƒì‹œê·¼ë¬´ (ë°©í•™ì¤‘ ë¹„ê·¼ë¬´)</option>
                                <option value="ìƒì‹œê·¼ë¬´">3. ìƒì‹œê·¼ë¬´ (ë°©í•™ì¤‘ ê·¼ë¬´)</option>
                                <option value="ë°©í•™ì¤‘ê·¼ë¬´">4. ë°©í•™ì¤‘ ê·¼ë¬´ (ë°©í•™ë§Œ)</option>
                                <option value="ê·¸ì™¸">5. ê·¸ì™¸ í˜•íƒœ (ì§ì ‘ì…ë ¥)</option>
                            </select>
                        </div>
                        <div class="input-group" id="wTypeOtherContainer" style="display: none; grid-column: span 3;">
                            <label>ê·¼ë¬´í˜•íƒœ ì§ì ‘ ì…ë ¥</label>
                            <input type="text" id="wTypeOther" placeholder="ì˜ˆ: ì¬íƒê·¼ë¬´, íŠ¹ìˆ˜ì‚¬ì—… ë“±"
                                style="padding: 0.8rem; border: 1px solid var(--border); border-radius: 8px;">
                        </div>
                        <div class="input-group" style="grid-column: span 3;">
                            <label>ì£¼ì†Œ</label>
                            <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                                <input type="text" id="wAddress" placeholder="ê¸°ë³¸ ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: ì„œìš¸ì‹œ ê°•ë‚¨êµ¬)">
                                <input type="text" id="wAddressDetail" placeholder="ìƒì„¸ ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš” (ë™, í˜¸ìˆ˜ ë“±)">
                            </div>
                        </div>
                        <div class="input-group" style="grid-column: span 3;">
                            <label>ë¹„ê³ </label>
                            <input type="text" id="wNote">
                        </div>

                        <!-- ìƒì„¸ ê·¼ë¬´ ì„¤ì • (ë³µêµ¬ë¨ v1.7.3) -->
                        <div
                            style="margin-top: 1rem; border-top: 1px solid var(--border); padding-top: 1rem; grid-column: span 3;">
                            <h4 style="margin-bottom: 0.8rem; color: var(--primary);">ğŸ“… ìƒì„¸ ê·¼ë¬´ ì„¤ì •</h4>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem;">
                                <!-- ê¸°ê°„ -->
                                <div class="glass" style="padding: 1rem; border-radius: 8px;">
                                    <h5 style="margin-bottom: 0.8rem; color: var(--text-muted);"><i
                                            data-lucide="calendar" style="width: 14px;"></i> ê³„ì•½ ê¸°ê°„</h5>
                                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem;">
                                        <div class="input-group" style="margin-bottom: 0;">
                                            <label style="font-size:0.7rem;">ì‹œì‘</label>
                                            <input type="date" id="wContractStart">
                                        </div>
                                        <div class="input-group" style="margin-bottom: 0;">
                                            <label style="font-size:0.7rem;">ì¢…ë£Œ</label>
                                            <input type="date" id="wContractEnd">
                                        </div>
                                    </div>
                                </div>
                                <!-- ì‹œê°„ -->
                                <div class="glass" style="padding: 1rem; border-radius: 8px;">
                                    <h5 style="margin-bottom: 0.8rem; color: var(--text-muted);"><i data-lucide="clock"
                                            style="width: 14px;"></i> ê·¼ë¬´ ì‹œê°„</h5>
                                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                                        <div class="input-group" style="flex: 1; margin-bottom: 0;">
                                            <label style="font-size:0.7rem;">ì¶œê·¼</label>
                                            <select id="wWorkTime"
                                                style="padding: 0.5rem; width:100%; border-radius: 4px;"></select>
                                        </div>
                                        <span style="padding-top: 1.2rem;">~</span>
                                        <div class="input-group" style="flex: 1; margin-bottom: 0;">
                                            <label style="font-size:0.7rem;">í‡´ê·¼</label>
                                            <select id="wEndTime"
                                                style="padding: 0.5rem; width:100%; border-radius: 4px;"></select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- ìš”ì¼ -->
                            <div class="input-group" style="margin-top: 1.2rem;">
                                <label style="margin-bottom: 0.5rem;">ì¶œê·¼ ìš”ì¼ (ë§¤ì£¼ ë°˜ë³µ)</label>
                                <div
                                    style="display: flex; gap: 0.8rem; flex-wrap: wrap; background: rgba(255,255,255,0.05); padding: 0.8rem; border-radius: 8px;">
                                    <label style="display: flex; align-items: center; gap: 0.3rem;"><input
                                            type="checkbox" name="workDay" value="1"> ì›”</label>
                                    <label style="display: flex; align-items: center; gap: 0.3rem;"><input
                                            type="checkbox" name="workDay" value="2"> í™”</label>
                                    <label style="display: flex; align-items: center; gap: 0.3rem;"><input
                                            type="checkbox" name="workDay" value="3"> ìˆ˜</label>
                                    <label style="display: flex; align-items: center; gap: 0.3rem;"><input
                                            type="checkbox" name="workDay" value="4"> ëª©</label>
                                    <label style="display: flex; align-items: center; gap: 0.3rem;"><input
                                            type="checkbox" name="workDay" value="5"> ê¸ˆ</label>
                                    <label
                                        style="display: flex; align-items: center; gap: 0.3rem; color: #5fafff;"><input
                                            type="checkbox" name="workDay" value="6"> í† </label>
                                    <label
                                        style="display: flex; align-items: center; gap: 0.3rem; color: #ff5f5f;"><input
                                            type="checkbox" name="workDay" value="0"> ì¼</label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div
                        style="display: flex; gap: 1rem; margin-top: 2rem; border-top: 1px solid var(--border); padding-top: 1.5rem;">
                        <button type="submit" class="btn btn-primary"
                            style="flex: 2; height: 50px; font-size: 1.1rem; border-radius: 12px; box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);">ì¸ì›
                            ì •ë³´ ì €ì¥í•˜ê¸°</button>
                        <button type="button" class="btn btn-secondary" style="flex: 1; border-radius: 12px;"
                            onclick="closeWorkerModal()">ì·¨ì†Œ</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Settings Auth Modal -->
        <div id="settingsAuthModal" class="modal-overlay">
            <div class="glass modal-content" style="max-width: 350px; text-align: center; padding: 2rem;">
                <div class="brand-logo" style="width: 48px; height: 48px; margin-bottom: 1rem;">
                    <i data-lucide="lock" style="width: 24px; height: 24px;"></i>
                </div>
                <h3>ë³´ì•ˆ ì¸ì¦</h3>
                <p style="font-size: 0.85rem; color: var(--text-muted); margin-bottom: 1.5rem;">ì„¤ì • ì§„ì…ì„ ìœ„í•´ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.
                </p>
                <div class="input-group">
                    <input type="password" id="settingsAuthPw" class="login-input" placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥"
                        autocomplete="new-password"
                        style="margin-bottom: 1rem; background: white !important; color: black !important; font-weight: bold;"
                        onkeyup="if(event.key==='Enter') checkSettingsAuth()">
                </div>
                <div style="display: flex; gap: 0.5rem;">
                    <button class="btn btn-primary" onclick="checkSettingsAuth()" style="flex: 2;">í™•ì¸</button>
                    <button class="btn btn-secondary" onclick="closeSettingsAuth()" style="flex: 1;">ì·¨ì†Œ</button>
                </div>
            </div>
        </div>

        <div id="printSection" class="print-only"></div>

        <script>
            lucide.createIcons();

            const monthInput = document.getElementById('filterMonth');
            const holidayMonthInput = document.getElementById('holidayMonth');
            const now = new Date();
            const currentMonthStr = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}`;
            monthInput.value = currentMonthStr;
            holidayMonthInput.value = currentMonthStr;

            let pendingSection = null;
            let pendingNavItem = null;

            function showSection(id, el) {
                // ì„¤ì • íƒ­ ì§„ì… ì‹œ ë³´ì•ˆ í™•ì¸ (ì»¤ìŠ¤í…€ ëª¨ë‹¬)
                if (id === 'settingsView') {
                    pendingSection = id;
                    pendingNavItem = el;
                    document.getElementById('settingsAuthModal').style.display = 'flex';
                    document.getElementById('settingsAuthPw').value = '';
                    document.getElementById('settingsAuthPw').focus();
                    return;
                }
                switchTab(id, el);
            }

            function switchTab(id, el) {
                document.querySelectorAll('.view-section').forEach(s => s.classList.remove('active'));
                document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                document.getElementById(id).classList.add('active');
                if (el) el.classList.add('active');

                if (id === 'aggView') renderAggregatedTable();
                if (id === 'workerView') renderWorkerTable();
                if (id === 'holidayView') renderHolidayCalendar();
                if (id === 'annualView') renderAnnualTable();
                if (id === 'noticeView') loadNotice(); // [v2.2.0] ê³µì§€ì‚¬í•­ ë¡œë“œ
                if (id === 'settingsView') {
                    document.getElementById('autoLogoutInput').value = AttendanceDB.getAutoLogoutTime();
                    document.getElementById('deadlineInput').value = AttendanceDB.getDeadline();

                    // ë°©í•™ ì„¤ì • ë¡œë“œ (v1.7)
                    const v = AttendanceDB.getVacations();
                    document.getElementById('vacSStart').value = v.sStart;
                    document.getElementById('vacSEnd').value = v.sEnd;
                    document.getElementById('vacWStart').value = v.wStart;
                    document.getElementById('vacWEnd').value = v.wEnd;
                    document.getElementById('vacPStart').value = v.pStart;
                    document.getElementById('vacPEnd').value = v.pEnd;
                }
            }

            // --- ìë™ ë¡œê·¸ì•„ì›ƒ ë¡œì§ ---
            let inactivityTimer;
            function resetInactivityTimer() {
                clearTimeout(inactivityTimer);
                const minutes = AttendanceDB.getAutoLogoutTime();
                if (minutes > 0 && document.getElementById('adminContent').style.display === 'block') {
                    inactivityTimer = setTimeout(logoutAdmin, minutes * 60 * 1000);
                }
            }

            function logoutAdmin() {
                document.getElementById('adminContent').style.display = 'none';
                document.getElementById('loginScreen').style.display = 'flex';
                document.getElementById('adminPasswordInput').value = '';
                alert('ì¥ì‹œê°„ í™œë™ì´ ì—†ì–´ ë³´ì•ˆì„ ìœ„í•´ ìë™ ë¡œê·¸ì•„ì›ƒë˜ì—ˆìŠµë‹ˆë‹¤.');
            }

            ['mousedown', 'mousemove', 'keypress', 'scroll', 'touchstart'].forEach(name => {
                document.addEventListener(name, resetInactivityTimer, true);
            });
            // -----------------------

            function checkSettingsAuth() {
                const input = document.getElementById('settingsAuthPw').value;
                if (input === AttendanceDB.getPassword()) {
                    const sectionId = pendingSection;
                    const navItem = pendingNavItem;
                    closeSettingsAuth();
                    if (sectionId) switchTab(sectionId, navItem);
                } else {
                    alert('ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                    document.getElementById('settingsAuthPw').value = '';
                    document.getElementById('settingsAuthPw').focus();
                }
            }

            function closeSettingsAuth() {
                document.getElementById('settingsAuthModal').style.display = 'none';
                pendingSection = null;
                pendingNavItem = null;
            }

            async function toggleHoliday(dateStr) {
                const currentName = HolidayUtil.getHolidayName(dateStr);
                const isCustom = HolidayUtil.customHolidays[dateStr];
                const isVac = AttendanceDB.isInVacation(dateStr);

                // ë°©í•™ ê¸°ê°„ì¸ ê²½ìš°: ë°©í•™ ì¤‘ ì¶œê·¼ì¼ í† ê¸€
                if (isVac) {
                    const workingDays = AttendanceDB.getVacationWorkingDays();
                    if (workingDays.includes(dateStr)) {
                        if (confirm(`'${dateStr}'ì„(ë¥¼) ë°©í•™ ì¤‘ ì¶œê·¼ì¼ì—ì„œ í•´ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                            const updated = workingDays.filter(d => d !== dateStr);
                            await AttendanceDB.saveVacationWorkingDays(updated);
                        }
                    } else {
                        if (confirm(`'${dateStr}'ì€ ë°©í•™ ê¸°ê°„ì…ë‹ˆë‹¤.\nì´ ë‚ ì„ 'ë°©í•™ ì¤‘ ì¶œê·¼ì¼'ë¡œ ì§€ì •í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                            workingDays.push(dateStr);
                            await AttendanceDB.saveVacationWorkingDays(workingDays);
                        }
                    }
                    renderHolidayCalendar();
                    return;
                }

                // ì¼ë°˜ ë‚ ì§œì¸ ê²½ìš°: ê¸°ì¡´ íœ´ì¼ í† ê¸€ logic
                if (currentName) {
                    if (!isCustom) {
                        alert(`'${currentName}'ì€(ëŠ”) ê¸°ë³¸ ê³µíœ´ì¼ì´ë¼ ìˆ˜ì •í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`);
                        return;
                    }
                    if (confirm(`'${currentName}'ì„(ë¥¼) íœ´ì¼ ëª©ë¡ì—ì„œ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                        await HolidayUtil.setCustom(dateStr, null);
                    }
                } else {
                    const name = prompt('íœ´ì¼ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: ê°œêµê¸°ë…ì¼, ì¬ëŸ‰íœ´ì—…ì¼)', 'í•™êµì¬ëŸ‰íœ´ì—…ì¼');
                    if (name) await HolidayUtil.setCustom(dateStr, name);
                }
                renderHolidayCalendar();
            }

            function renderHolidayCalendar() {
                const [year, month] = holidayMonthInput.value.split('-').map(Number);
                const firstDay = new Date(year, month - 1, 1).getDay();
                const daysInMonth = new Date(year, month, 0).getDate();
                const grid = document.getElementById('holidayCalendarGrid');
                grid.innerHTML = '';
                for (let i = 0; i < firstDay; i++) {
                    const empty = document.createElement('div');
                    empty.className = 'calendar-day disabled';
                    grid.appendChild(empty);
                }
                for (let i = 1; i <= daysInMonth; i++) {
                    const day = document.createElement('div');
                    day.className = 'calendar-day';
                    day.innerHTML = `<span>${i}</span>`;
                    const dateStr = `${holidayMonthInput.value}-${String(i).padStart(2, '0')}`;

                    const holidayName = HolidayUtil.getHolidayName(dateStr);
                    const isVac = AttendanceDB.isInVacation(dateStr);
                    const workingDays = AttendanceDB.getVacationWorkingDays();
                    const isWorkingDay = workingDays.includes(dateStr);

                    if (holidayName) {
                        day.classList.add('holiday');
                        day.classList.add('selected');
                        day.innerHTML += `<div class="holiday-name">${holidayName}</div>`;
                    } else if (isVac) {
                        // ë°©í•™ ê¸°ê°„ í‘œì‹œ
                        day.style.backgroundColor = '#d1fae5'; // emerald-100
                        day.style.border = '1px solid #34d399';
                        if (isWorkingDay) {
                            day.style.border = '3px solid var(--primary)';
                            day.innerHTML += `<div style="font-size: 0.6rem; color: var(--primary); font-weight: 800; margin-top: 2px;">â˜… ì¶œê·¼ì¼ ì§€ì •</div>`;
                        } else {
                            day.innerHTML += `<div style="font-size: 0.6rem; color: #059669; margin-top: 2px;">ë°©í•™</div>`;
                        }
                    }

                    day.onclick = () => toggleHoliday(dateStr);
                    grid.appendChild(day);
                }
            }

            function renderAggregatedTable() {
                const data = AttendanceDB.getAll();
                const workers = AttendanceDB.getWorkers();
                const filterName = document.getElementById('filterName').value.toLowerCase();
                const filterMonth = monthInput.value;

                // í†µê³„ ì´ˆê¸°í™”
                const totalStats = { submitted: 0, total: workers.length };
                const typeStats = {
                    'ê¸°ê°„ê·¼ë¬´': { s: 0, t: 0 },
                    'ìƒì‹œ(ë°©í•™ë¹„ê·¼ë¬´)': { s: 0, t: 0 },
                    'ìƒì‹œê·¼ë¬´': { s: 0, t: 0 },
                    'ë°©í•™ì¤‘ê·¼ë¬´': { s: 0, t: 0 },
                    'ê·¸ì™¸': { s: 0, t: 0 }
                };

                // ì „ì²´ ì¸ì› ìœ í˜•ë³„ ì§‘ê³„
                workers.forEach(w => {
                    const wt = w.workType || 'ê·¸ì™¸';
                    if (typeStats[wt]) typeStats[wt].t++;
                    else typeStats['ê·¸ì™¸'].t++;
                });

                const groups = {};
                data.forEach(item => {
                    const itemMonth = item.date.substring(0, 7);
                    if (itemMonth !== filterMonth) return;
                    if (filterName && !item.name.toLowerCase().includes(filterName)) return;
                    if (!groups[item.name]) groups[item.name] = { name: item.name, month: itemMonth, days: new Set(), lastUpdate: item.timestamp };
                    groups[item.name].days.add(item.date);
                    if (new Date(item.timestamp) > new Date(groups[item.name].lastUpdate)) groups[item.name].lastUpdate = item.timestamp;
                });

                const groupArray = Object.values(groups);

                // ì œì¶œ ì¸ì› ìœ í˜•ë³„ ì§‘ê³„
                groupArray.forEach(g => {
                    const worker = workers.find(w => w.name === g.name);
                    const wt = (worker && worker.workType) ? worker.workType : 'ê·¸ì™¸';
                    if (typeStats[wt]) typeStats[wt].s++;
                    else typeStats['ê·¸ì™¸'].s++;
                });

                // í†µê³„ UI ë°˜ì˜
                document.getElementById('statsTotal').innerText = `${groupArray.length} / ${workers.length}`;
                document.getElementById('statsType1').innerText = `${typeStats['ê¸°ê°„ê·¼ë¬´'].s} / ${typeStats['ê¸°ê°„ê·¼ë¬´'].t}`;
                document.getElementById('statsType2').innerText = `${typeStats['ìƒì‹œ(ë°©í•™ë¹„ê·¼ë¬´)'].s} / ${typeStats['ìƒì‹œ(ë°©í•™ë¹„ê·¼ë¬´)'].t}`;
                document.getElementById('statsType3').innerText = `${typeStats['ìƒì‹œê·¼ë¬´'].s} / ${typeStats['ìƒì‹œê·¼ë¬´'].t}`;
                document.getElementById('statsType4').innerText = `${typeStats['ë°©í•™ì¤‘ê·¼ë¬´'].s} / ${typeStats['ë°©í•™ì¤‘ê·¼ë¬´'].t}`;
                document.getElementById('statsType5').innerText = `${typeStats['ê·¸ì™¸'].s} / ${typeStats['ê·¸ì™¸'].t}`;

                const tbody = document.querySelector('#summaryTable tbody');
                tbody.innerHTML = '';
                groupArray.sort((a, b) => new Date(b.lastUpdate) - new Date(a.lastUpdate));
                groupArray.forEach((group, index) => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                    <td>${groupArray.length - index}</td>
                    <td style="font-weight:600;">${group.name}</td>
                    <td>${group.month}</td>
                    <td><span class="badge badge-success">${group.days.size}ì¼</span></td>
                    <td style="font-size: 0.8rem;">${new Date(group.lastUpdate).toLocaleString()}</td>
                    <td><button class="btn btn-secondary btn-sm" onclick="printIndividual('${group.name}', '${group.month}')">ì¶œë ¥</button></td>
                `;
                    tbody.appendChild(tr);
                });
                lucide.createIcons();
            }

            function renderAnnualTable() {
                const fiscalYearSelect = document.getElementById('fiscalYearSelect');
                if (!fiscalYearSelect) return;
                const fiscalYear = parseInt(fiscalYearSelect.value);
                const data = AttendanceDB.getAll();
                const workers = AttendanceDB.getWorkers();
                const tbody = document.querySelector('#annualTable tbody');
                tbody.innerHTML = '';
                const nameSet = new Set(workers.map(w => w.name));
                data.forEach(r => nameSet.add(r.name));

                const months = [3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 1, 2];
                Array.from(nameSet).sort().forEach(name => {
                    const worker = workers.find(w => w.name === name);
                    const tr = document.createElement('tr');
                    let html = `<td style="font-weight:600;">${name}</td>`;
                    months.forEach(m => {
                        const y = (m <= 2) ? fiscalYear + 1 : fiscalYear;
                        const mStr = `${y}-${String(m).padStart(2, '0')}`;
                        const count = data.filter(r => r.name === name && r.date.startsWith(mStr)).length;
                        html += `<td>${count > 0 ? count + 'ì¼' : '-'}</td>`;
                    });
                    html += `<td style="font-size:0.85rem; color:var(--text-muted); background:#f8fafc;">${worker ? (worker.note || '') : ''}</td>`;
                    tr.innerHTML = html;
                    tbody.appendChild(tr);
                });
            }

            function renderWorkerTable() {
                renderPendingWorkers(); // [v2.3.0] ëŒ€ê¸° ì¸ì› ë Œë”ë§ í˜¸ì¶œ
                const workers = AttendanceDB.getWorkers();
                const tbody = document.querySelector('#workerTable tbody');
                tbody.innerHTML = '';
                workers.forEach(w => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                    <td><input type="checkbox" class="worker-check" data-id="${w.id}" data-name="${w.name}" data-phone="${w.phone}"></td>
                    <td style="font-weight:600;">${w.name}</td>
                    <td>${w.phone}</td>
                    <td>${w.type}</td>
                    <td>${w.address}</td>
                    <td>${w.note}</td>
                    <td>
                        <div style="display:flex; gap:0.5rem;">
                            <button class="btn btn-secondary btn-sm" onclick="editWorker('${w.id}')">ìˆ˜ì •</button>
                            <button class="btn btn-secondary btn-sm" onclick="deleteWorker(${w.id})">ì‚­ì œ</button>
                        </div>
                    </td>
                `;
                    tbody.appendChild(tr);
                });
                lucide.createIcons();
            }

            // [v1.9.0] Excel ì—…ë¡œë“œ/ë‹¤ìš´ë¡œë“œ ê´€ë ¨ í•¸ë“¤ëŸ¬
            function triggerExcelUpload() { document.getElementById('workerExcelInput').click(); }
            async function handleExcelUpload(e) {
                const file = e.target.files[0];
                if (file) {
                    const count = await ExcelUtil.importWorkers(file);
                    if (count > 0) renderWorkerTable();
                }
                e.target.value = ''; // ì´ˆê¸°í™”
            }
            function exportWorkersExcel() { ExcelUtil.exportWorkers(); }

            function toggleAllWorkers(master) { document.querySelectorAll('.worker-check').forEach(cb => cb.checked = master.checked); }

            async function copyAttendanceLink() {
                const now = new Date();
                const year = now.getFullYear();
                const month = now.getMonth() + 1;
                const date = now.getDate();
                const deadline = AttendanceDB.getDeadline();

                const msg = `[ê·¼íƒœê´€ë¦¬ ì•ˆë‚´]\n\n${year}ë…„ ${month}ì›”ë¶„ ì¶œê·¼ë¶€ ì‘ì„±ì„ ë¶€íƒë“œë¦½ë‹ˆë‹¤.\n\n- ë³´ë‚´ëŠ” ì¼ì: ${year}.${month}.${date}\n- ì œì¶œ ê¸°í•œ: ${deadline}ê¹Œì§€\n\nì•„ë˜ ì£¼ì†Œë¡œ ì ‘ì†í•˜ì—¬ ë³¸ì¸ ì„±ëª… ì…ë ¥ í›„ ì„œëª…í•´ ì£¼ì„¸ìš”.\n${getWorkerUrl()}`;

                try {
                    await navigator.clipboard.writeText(msg);
                    alert('ì•ˆë‚´ ë¬¸êµ¬ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!\nì›í•˜ëŠ” ê³³(ì¹´í†¡/ë¬¸ì ë“±)ì— ë¶™ì—¬ë„£ê¸°(Ctrl+V) í•˜ì„¸ìš”.');
                } catch (e) {
                    console.error('ë³µì‚¬ ì‹¤íŒ¨:', e);
                    alert('ë¬¸êµ¬ ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë¸Œë¼ìš°ì € ì„¤ì •ì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
                }
            }

            function getWorkerUrl() {
                let base = typeof GLOBAL_URL !== 'undefined' && GLOBAL_URL ? GLOBAL_URL : window.location.href.replace('admin.html', '');
                if (!base.endsWith('/')) base += '/';
                return `${base}worker.html`;
            }

            async function requestAttendance(name, phone) {
                const msg = `[ê·¼íƒœê´€ë¦¬] ì¶œê·¼ë¶€ ì‘ì„±ì„ ë¶€íƒë“œë¦½ë‹ˆë‹¤.\nì ‘ì† ì£¼ì†Œ: ${getWorkerUrl()}`;
                const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);

                try {
                    await navigator.clipboard.writeText(msg);
                    if (isMobile) {
                        window.location.href = `sms:${phone}${navigator.userAgent.match(/iPhone/i) ? '&' : '?'}body=${encodeURIComponent(msg)}`;
                    } else {
                        alert(`ì „ì²´ ê³µìš© ì•ˆë‚´ ë¬¸êµ¬ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.\nì›í•˜ëŠ” ê³³ì— ë¶™ì—¬ë„£ê¸°(Ctrl+V) í•˜ì„¸ìš”.`);
                    }
                } catch (e) {
                    window.location.href = `sms:${phone}${navigator.userAgent.match(/iPhone/i) ? '&' : '?'}body=${encodeURIComponent(msg)}`;
                }
            }

            async function copyToKakao(name, phone, isBatch = false) {
                const msg = `[ê·¼íƒœê´€ë¦¬] ì¶œê·¼ë¶€ ì‘ì„±ì„ ë¶€íƒë“œë¦½ë‹ˆë‹¤.\n\nì ‘ì† ì£¼ì†Œ: ${getWorkerUrl()}`;
                const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);

                try {
                    await navigator.clipboard.writeText(msg);
                    if (!isBatch) {
                        if (confirm(`ì•ˆë‚´ ë¬¸êµ¬ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.\ní™•ì¸ì„ ëˆ„ë¥´ë©´ ì¹´í†¡ì´ ì‹¤í–‰ë©ë‹ˆë‹¤. ì›í•˜ëŠ” ì±„íŒ…ë°©ì— ë¶™ì—¬ë„£ê¸°(Ctrl+V) í•˜ì„¸ìš”.`)) {
                            window.location.href = 'kakaotalk://';
                        }
                    } else {
                        if (isMobile) window.location.href = 'kakaotalk://';
                    }
                } catch (e) {
                    prompt('ë³µì‚¬ ì‹¤íŒ¨. ì•„ë˜ ë¬¸êµ¬ë¥¼ ì§ì ‘ ë³µì‚¬í•˜ì„¸ìš”:', msg);
                }
            }

            function closeWorkerModal(e) {
                if (e && e.target !== e.currentTarget) return;
                document.getElementById('workerModal').style.display = 'none';
            }

            function handleWorkTypeChange(val) {
                const container = document.getElementById('wTypeOtherContainer');
                if (val === 'ê·¸ì™¸') {
                    container.style.display = 'block';
                    document.getElementById('wTypeOther').focus();
                } else {
                    container.style.display = 'none';
                }

                // ìœ í˜• 2, 3 ìƒì‹œ ì¶œê·¼ì í•„ë“œ ë¹„í™œì„±í™” ë¡œì§ (v1.8.1)
                const isRegular = (val === 'ìƒì‹œ(ë°©í•™ë¹„ê·¼ë¬´)' || val === 'ìƒì‹œê·¼ë¬´');
                const fieldsToDisable = ['wContractStart', 'wContractEnd', 'wWorkTime', 'wEndTime'];
                fieldsToDisable.forEach(id => {
                    const el = document.getElementById(id);
                    if (el) {
                        el.disabled = isRegular;
                        el.style.opacity = isRegular ? '0.5' : '1';
                        el.style.background = isRegular ? '#f1f5f9' : '';
                    }
                });

                document.querySelectorAll('input[name="workDay"]').forEach(cb => {
                    cb.disabled = isRegular;
                    cb.parentElement.style.opacity = isRegular ? '0.5' : '1';
                    cb.parentElement.style.pointerEvents = isRegular ? 'none' : 'auto';
                });
            }

            function openWorkerModal(worker = null, registerData = null) {
                const m = document.getElementById('workerModal');
                document.getElementById('workerForm').reset();
                document.getElementById('wId').value = worker ? worker.id : '';
                document.getElementById('wTypeOtherContainer').style.display = 'none';

                // ìš”ì¼ ì²´í¬ë°•ìŠ¤ ì´ˆê¸°í™”
                document.querySelectorAll('input[name="workDay"]').forEach(cb => cb.checked = false);

                if (worker) {
                    document.getElementById('wName').value = worker.name || '';
                    document.getElementById('wPhone').value = worker.phone || '';
                    document.getElementById('wAddress').value = worker.address || '';
                    document.getElementById('wAddressDetail').value = worker.addressDetail || '';
                    document.getElementById('wNote').value = worker.note || '';

                    // ê·¼ë¬´ í˜•íƒœ ì •ë³´ (v1.7.2 ë³µêµ¬)
                    document.getElementById('wContractStart').value = worker.contractStartDate || '';
                    document.getElementById('wContractEnd').value = worker.contractEndDate || '';
                    document.getElementById('wWorkTime').value = worker.workTime || '';
                    document.getElementById('wEndTime').value = worker.endTime || '';

                    // ìš”ì¼ ì²´í¬
                    if (Array.isArray(worker.workDays)) {
                        worker.workDays.forEach(dayIndex => {
                            const cb = document.querySelector(`input[name="workDay"][value="${dayIndex}"]`);
                            if (cb) cb.checked = true;
                        });
                    }

                    // ê·¼ë¬´í˜•íƒœ ëª…ì¹­ ë³µêµ¬
                    const select = document.getElementById('wWorkType');
                    const options = Array.from(select.options).map(o => o.value);
                    if (options.includes(worker.workType)) {
                        select.value = worker.workType;
                        document.getElementById('wTypeOtherContainer').style.display = 'none';
                    } else {
                        select.value = 'ê·¸ì™¸';
                        document.getElementById('wTypeOtherContainer').style.display = 'block';
                        document.getElementById('wTypeOther').value = worker.workType || '';
                    }
                } else if (registerData) {
                    // [v2.3.0] ì‹ ê·œ ìŠ¹ì¸ ë¡œì§ (ìë™ ì±„ì›€)
                    document.getElementById('wName').value = registerData.name || '';
                    document.getElementById('wPhone').value = registerData.phone || '';
                    // ìƒë…„ì›”ì¼ì€ ë¹„ê³ ë€ì— ìë™ ê¸°ì… (ê°œì¸ì •ë³´ ë³´í˜¸ë¥¼ ìœ„í•´ 'ì¸ì¦í™•ì¸'ìœ¼ë¡œ ë³€ê²½)
                    document.getElementById('wNote').value = 'ì¸ì¦í™•ì¸';
                    // ëŒ€ê¸° ëª©ë¡ IDë¥¼ íˆë“  í•„ë“œê°€ ì•„ë‹Œ ë³„ë„ ì†ì„±ìœ¼ë¡œ ì €ì¥í•´ë‘ë©´ ì¢‹ì§€ë§Œ, 
                    // ì—¬ê¸°ì„œëŠ” ì €ì¥ì´ ì™„ë£Œë˜ë©´ ëŒ€ê¸° ëª©ë¡ì—ì„œ ì‚­ì œí•˜ëŠ” ë°©ì‹ì„ ì‚¬ìš©í•˜ë¯€ë¡œ wIdëŠ” ë¹„ì›Œë‘¡ë‹ˆë‹¤.
                    // ëŒ€ì‹  ì „ì—­ ë³€ìˆ˜ë‚˜ ì†ì„±ìœ¼ë¡œ pendingIdë¥¼ ë„˜ê²¨ì£¼ì–´ì•¼ ì‚­ì œê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.
                    document.getElementById('workerForm').dataset.pendingId = registerData.id;
                }

                m.style.display = 'flex';
                handleWorkTypeChange(document.getElementById('wWorkType').value); // ì´ˆê¸° ë¹„í™œì„±í™” ìƒíƒœ ì ìš©
                lucide.createIcons();
            }

            function editWorker(id) {
                const w = AttendanceDB.getWorkers().find(x => x.id == id);
                if (w) openWorkerModal(w);
            }

            async function saveWorker(e) {
                e.preventDefault();
                const id = document.getElementById('wId').value;

                let selectedType = document.getElementById('wWorkType').value;
                if (selectedType === 'ê·¸ì™¸') {
                    selectedType = document.getElementById('wTypeOther').value.trim() || 'ê¸°íƒ€';
                }

                // ìš”ì¼ ì„ íƒ ê°’ ìˆ˜ì§‘
                const workDays = Array.from(document.querySelectorAll('input[name="workDay"]:checked')).map(cb => parseInt(cb.value));

                const isRegular = (selectedType === 'ìƒì‹œ(ë°©í•™ë¹„ê·¼ë¬´)' || selectedType === 'ìƒì‹œê·¼ë¬´');

                const w = {
                    name: document.getElementById('wName').value,
                    phone: document.getElementById('wPhone').value,
                    type: selectedType, // ì´ì „ í•„ë“œ í˜¸í™˜ìš©
                    workType: selectedType, // v1.7 ì‹ ê·œ í•„ë“œ
                    address: document.getElementById('wAddress').value,
                    addressDetail: document.getElementById('wAddressDetail').value,
                    note: document.getElementById('wNote').value,
                    // ìƒì„¸ ê·¼ë¬´ ì •ë³´ ì €ì¥ (v1.7.2 ë³µêµ¬, v1.8.7 ìƒì‹œê·¼ë¬´ì ì´ˆê¸°í™” ì ìš©)
                    workDays: isRegular ? [] : workDays,
                    contractStartDate: isRegular ? '' : document.getElementById('wContractStart').value,
                    contractEndDate: isRegular ? '' : document.getElementById('wContractEnd').value,
                    workTime: isRegular ? '' : document.getElementById('wWorkTime').value,
                    endTime: isRegular ? '' : document.getElementById('wEndTime').value
                };

                // [ìœ íš¨ì„± ê²€ì‚¬ v1.8.8]
                if (!isRegular) {
                    if (w.contractStartDate && w.contractEndDate && w.contractStartDate > w.contractEndDate) {
                        return alert('ê³„ì•½ ì¢…ë£Œì¼ì´ ì‹œì‘ì¼ë³´ë‹¤ ë¹ ë¥¼ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    }
                    if (w.workTime && w.endTime && w.workTime >= w.endTime) {
                        return alert('í‡´ê·¼ ì‹œê°„ì´ ì¶œê·¼ ì‹œê°„ë³´ë‹¤ ë¹ ë¥´ê±°ë‚˜ ê°™ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    }
                }

                if (id) await AttendanceDB.updateWorker({ ...w, id }); else {
                    await AttendanceDB.saveWorker(w);
                    // [v2.3.0] ì‹ ê·œ ìŠ¹ì¸ ê±´ì´ì—ˆë‹¤ë©´ ëŒ€ê¸° ëª©ë¡ì—ì„œ ì‚­ì œ
                    const pendingId = document.getElementById('workerForm').dataset.pendingId;
                    if (pendingId) {
                        await AttendanceDB.deletePendingWorker(pendingId);
                        delete document.getElementById('workerForm').dataset.pendingId;
                    }
                }
                AudioUtil.playSuccess();
                document.getElementById('workerModal').style.display = 'none';
                renderWorkerTable();
            }

            // [v2.3.0] ëŒ€ê¸° ì¸ì› ë Œë”ë§ ë° ê´€ë¦¬
            function renderPendingWorkers() {
                const pending = AttendanceDB.getPendingWorkers();
                const section = document.getElementById('pendingSection');
                const tbody = document.querySelector('#pendingTable tbody');
                const countBadge = document.getElementById('pendingCount');

                // [v2.4.1] íƒ­ ë°°ì§€ ì—…ë°ì´íŠ¸
                const navBadge = document.getElementById('navPendingBadge');
                if (navBadge) {
                    if (pending.length > 0) {
                        navBadge.innerText = pending.length;
                        navBadge.style.display = 'inline-block';
                        // [v2.4.2] ë¹¨ê°„ìƒ‰ ê¹œë¹¡ì„ íš¨ê³¼ ì¶”ê°€
                        navBadge.classList.remove('badge-warning');
                        navBadge.classList.add('badge-blink');
                    } else {
                        navBadge.style.display = 'none';
                        navBadge.classList.remove('badge-blink');
                    }
                }

                if (pending.length === 0) {
                    section.style.display = 'none';
                    return;
                }

                section.style.display = 'block';
                countBadge.innerText = `${pending.length}ëª…`;
                tbody.innerHTML = '';

                pending.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp)); // ìµœì‹ ìˆœ

                pending.forEach(p => {
                    const tr = document.createElement('tr');
                    tr.style.background = '#fffbeb'; // ëŒ€ê¸° ì¤‘ ê°•ì¡° (ì—°í•œ ë…¸ë‘)
                    tr.innerHTML = `
                        <td style="font-size: 0.85rem; color: var(--text-muted);">${new Date(p.timestamp).toLocaleString()}</td>
                        <td style="font-weight: 700; color: var(--secondary);">${p.name}</td>
                        <td>${p.birth}</td>
                        <td>${p.phone}</td>
                        <td>
                            <div style="display:flex; gap:0.5rem;">
                                <button class="btn btn-primary btn-sm" onclick='approveWorker(${JSON.stringify(p)})'>ìŠ¹ì¸</button>
                                <button class="btn btn-secondary btn-sm" onclick="rejectWorker('${p.id}')" style="color: var(--danger);">ê±°ì ˆ</button>
                            </div>
                        </td>
                    `;
                    tbody.appendChild(tr);
                });
            }

            function approveWorker(pendingData) {
                // ëª¨ë‹¬ì„ ì—´ê³  ì •ë³´ë¥¼ ì±„ì›Œì¤Œ
                openWorkerModal(null, pendingData);
            }

            async function rejectWorker(id) {
                if (confirm('í•´ë‹¹ ì‹ ì²­ì„ ê±°ì ˆí•˜ê³  ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                    await AttendanceDB.deletePendingWorker(id);
                    renderWorkerTable(); // ì¬ë Œë”ë§
                }
            }

            function deleteWorker(id) { if (confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) { AttendanceDB.deleteWorker(id); renderWorkerTable(); } }

            // [v2.5.3] ì„ íƒ ì¸ì› ì¼ê´„ ì‚­ì œ
            async function deleteSelectedWorkers() {
                const checked = document.querySelectorAll('.worker-check:checked');
                if (checked.length === 0) return alert('ì‚­ì œí•  ì¸ì›ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');

                if (confirm(`ì„ íƒí•œ ${checked.length}ëª…ì˜ ì¸ì›ì„ ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                    for (const cb of checked) {
                        const id = cb.dataset.id;
                        if (id) await AttendanceDB.deleteWorker(id);
                    }
                    alert('ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                    renderWorkerTable();
                }
            }

            function updatePassword() {
                const pwInput = document.getElementById('newPassword');
                const pw = pwInput.value;
                if (pw.length < 4) return alert('4ìë¦¬ ì´ìƒ ì…ë ¥í•˜ì„¸ìš”.');
                if (confirm('ë¹„ë°€ë²ˆí˜¸ë¥¼ ë³€ê²½í• ê¹Œìš”?')) {
                    AttendanceDB.savePassword(pw);
                    alert('ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.');
                    pwInput.value = ''; // ì…ë ¥ì°½ ë¹„ìš°ê¸°
                }
            }

            function updateAppTitle() {
                const titleInput = document.getElementById('appTitleInput');
                const title = titleInput.value.trim();
                if (!title) return alert('ë³€ê²½í•  ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”.');
                if (confirm(`ì•± ì´ë¦„ì„ "${title}"(ìœ¼)ë¡œ ë³€ê²½í• ê¹Œìš”?`)) {
                    AttendanceDB.saveAppTitle(title);
                    refreshAppTitles();
                    alert('ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.');
                    titleInput.value = '';
                }
            }

            function updateAppLogo(input) {
                if (input.files && input.files[0]) {
                    const reader = new FileReader();
                    reader.onload = function (e) {
                        if (confirm('ì„ íƒí•œ ì´ë¯¸ì§€ë¥¼ ë¡œê³ ë¡œ ì‚¬ìš©í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                            AttendanceDB.saveAppLogo(e.target.result);
                            refreshAppTitles();
                            alert('ë¡œê³ ê°€ ì„±ê³µì ìœ¼ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.');
                        }
                    };
                    reader.readAsDataURL(input.files[0]);
                }
            }

            function resetAppLogo() {
                if (confirm('ë¡œê³ ë¥¼ ê¸°ë³¸ ì•„ì´ì½˜ìœ¼ë¡œ ì´ˆê¸°í™”í• ê¹Œìš”?')) {
                    AttendanceDB.saveAppLogo(null);
                    refreshAppTitles();
                    alert('ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
                }
            }

            function updateAutoLogoutTime() {
                const val = document.getElementById('autoLogoutInput').value;
                const minutes = parseInt(val);
                if (isNaN(minutes) || minutes < 0) return alert('ì˜¬ë°”ë¥¸ ì‹œê°„ì„ ì…ë ¥í•˜ì„¸ìš”.');
                AttendanceDB.saveAutoLogoutTime(minutes);
                resetInactivityTimer();
                alert('ìë™ ë¡œê·¸ì•„ì›ƒ ì‹œê°„ì´ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤.');
            }

            async function clearAllRecords() { if (confirm('ëª¨ë“  ì¶œê·¼ ê¸°ë¡ì„ ì‚­ì œí• ê¹Œìš”?')) { await AttendanceDB.clear(); alert('ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.'); renderAggregatedTable(); } }
            async function clearAllWorkersData() { if (confirm('ëª¨ë“  ì¸ì› ëª…ë‹¨ì„ ì‚­ì œí• ê¹Œìš”?')) { await AttendanceDB.clearWorkers(); alert('ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.'); renderWorkerTable(); } }

            function updateDeadline() {
                const val = document.getElementById('deadlineInput').value.trim();
                if (!val) return alert('ì œì¶œ ê¸°í•œì„ ì…ë ¥í•˜ì„¸ìš”.');
                AttendanceDB.saveDeadline(val);
                alert('ì œì¶œ ê¸°í•œì´ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤.');
            }

            // ë°©í•™ ì„¤ì • ì €ì¥ (v1.7)
            function updateVacationSettings() {
                const vac = {
                    sStart: document.getElementById('vacSStart').value,
                    sEnd: document.getElementById('vacSEnd').value,
                    wStart: document.getElementById('vacWStart').value,
                    wEnd: document.getElementById('vacWEnd').value,
                    pStart: document.getElementById('vacPStart').value,
                    pEnd: document.getElementById('vacPEnd').value
                };

                // [ìœ íš¨ì„± ê²€ì‚¬ v1.8.8]
                if (vac.sStart && vac.sEnd && vac.sStart > vac.sEnd) return alert('ì—¬ë¦„ ë°©í•™ ì¢…ë£Œì¼ì´ ì‹œì‘ì¼ë³´ë‹¤ ë¹ ë¦…ë‹ˆë‹¤.');
                if (vac.wStart && vac.wEnd && vac.wStart > vac.wEnd) return alert('ê²¨ìš¸ ë°©í•™ ì¢…ë£Œì¼ì´ ì‹œì‘ì¼ë³´ë‹¤ ë¹ ë¦…ë‹ˆë‹¤.');
                if (vac.pStart && vac.pEnd && vac.pStart > vac.pEnd) return alert('ë´„ ë°©í•™(í•™ê¸°ë§) ì¢…ë£Œì¼ì´ ì‹œì‘ì¼ë³´ë‹¤ ë¹ ë¦…ë‹ˆë‹¤.');

                if (confirm('ë°©í•™ ê¸°ê°„ì„ ì €ì¥í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì´ ê¸°ê°„ì— ë§ì¶° ì§ì› ì¶œê·¼ë¶€ê°€ ìë™ ì œì–´ë©ë‹ˆë‹¤.')) {
                    AttendanceDB.saveVacations(vac);
                    alert('ë°©í•™ ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
                }
            }

            function printAnnualReport() {
                const select = document.getElementById('fiscalYearSelect');
                const fy = select ? select.value : '';
                const win = window.open('', '_blank');
                win.document.write(`<html><head><title>${fy}íšŒê¸° ì§‘ê³„ ë¦¬í¬íŠ¸</title><style>table{width:100%;border-collapse:collapse;font-size:10pt;}th,td{border:1px solid #000;padding:5px;text-align:center;}th{background:#f8fafc;}</style></head><body><h1>${fy}íšŒê¸° ì¶œê·¼ ì§‘ê³„í‘œ (3ì›”~ìµë…„ 2ì›”)</h1>${document.getElementById('annualTable').outerHTML}</body></html>`);
                win.document.close(); win.print();
            }

            function generateCalendarHTML(name, month, records) {
                const [y, m] = month.split('-').map(Number);
                const days = new Date(y, m, 0).getDate();
                const first = new Date(y, m - 1, 1).getDay();
                const worker = AttendanceDB.getWorkerByName(name);
                let grid = '';
                ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '].forEach(d => grid += `<div class="calendar-print-header">${d}</div>`);
                for (let i = 0; i < first; i++) grid += '<div class="calendar-print-day other-month"></div>';
                for (let i = 1; i <= days; i++) {
                    const ds = `${month}-${String(i).padStart(2, '0')}`;
                    const entry = records.find(r => r.date === ds);
                    const holiday = HolidayUtil.getHolidayName(ds);
                    const isVac = AttendanceDB.isInVacation(ds);
                    const workingDays = AttendanceDB.getVacationWorkingDays();
                    const isVacWorking = workingDays.includes(ds);
                    const isWE = new Date(y, m - 1, i).getDay() % 6 === 0;

                    let classes = ['calendar-print-day'];
                    if (isWE) classes.push('weekend');
                    if (holiday) classes.push('holiday');
                    if (isVac) classes.push('vacation');
                    if (isVacWorking) classes.push('vacation-working');

                    grid += `<div class="${classes.join(' ')}">
                        <div style="font-size:12pt; font-weight:800; border-bottom:1px solid #eee; padding-bottom:2px;">${i}</div>
                        ${holiday ? `<div class="holiday-name">${holiday}</div>` : ''}
                        ${(isVac && !holiday && !isVacWorking) ? `<div class="holiday-name" style="color:#059669; border-color:#d1fae5;">ë°©í•™</div>` : ''}
                        ${isVacWorking ? `<div class="holiday-name" style="color:var(--primary); border-color:#ddd6fe; font-weight:bold;">ë°©í•™ì¤‘ê·¼ë¬´</div>` : ''}
                        <div style="margin-top:auto; display:flex; flex-direction:column; align-items:center;">
                            ${entry ? `<img src="${entry.signature}" class="sig-img" style="max-height:25px; margin-bottom:2px;"><span style="font-size:8px; font-weight:600;">${name}</span>` : ''}
                        </div>
                    </div>`;
                }
                return `<div class="a4-page">
                    <div style="text-align:center; margin-bottom:15px; border-bottom:2px solid #000; padding-bottom:10px;">
                        <h1 style="margin:0; font-size:28pt; letter-spacing:10px;">ì¶œê·¼ë¶€</h1>
                    </div>
                    <div style="display:grid; grid-template-columns: 1fr 1fr; gap:8px 20px; margin-bottom:10px; font-size:11pt;">
                        <div style="border-bottom:1px solid #ddd; padding:4px;">ì„±ëª…: <b>${name}</b></div>
                        <div style="border-bottom:1px solid #ddd; padding:4px; text-align:right;">ê¸°ê°„: <b>${y}ë…„ ${m}ì›”</b></div>
                        <div style="border-bottom:1px solid #ddd; padding:4px;">ì—°ë½ì²˜: ${worker ? worker.phone : '-'}</div>
                        <div style="border-bottom:1px solid #ddd; padding:4px; text-align:right;">ì£¼ì†Œ: ${worker ? (worker.address || '-') : '-'}</div>
                    </div>
                    <div class="calendar-print">${grid}</div>
                </div>`;
            }

            async function waitForImagesAndPrint() {
                const images = document.querySelectorAll('#printSection img');
                const promises = Array.from(images).map(img => {
                    if (img.complete) return Promise.resolve();
                    return new Promise(resolve => {
                        img.onload = resolve;
                        img.onerror = resolve; // ì—ëŸ¬ ì‹œì—ë„ ì¸ì‡„ëŠ” ì§„í–‰
                    });
                });

                // ëª¨ë“  ì´ë¯¸ì§€ê°€ ë¡œë“œë  ë•Œê¹Œì§€ ëŒ€ê¸°
                await Promise.all(promises);
                // ë¸Œë¼ìš°ì € ë Œë”ë§ì„ ìœ„í•´ ì•„ì£¼ ì ê¹ ëŒ€ê¸°
                setTimeout(() => {
                    window.print();
                }, 100);
            }

            async function printIndividual(name, month) {
                const d = AttendanceDB.getAll().filter(r => r.name === name && r.date.startsWith(month));
                document.getElementById('printSection').innerHTML = generateCalendarHTML(name, month, d);
                await waitForImagesAndPrint();
            }

            async function printAll() {
                const d = AttendanceDB.getAll();
                const m = monthInput.value;
                const names = [...new Set(d.filter(r => r.date.startsWith(m)).map(r => r.name))];
                if (names.length === 0) return alert('ë°ì´í„° ì—†ìŒ');
                let html = '';
                names.forEach(n => html += generateCalendarHTML(n, m, d.filter(r => r.name === n && r.date.startsWith(m))));
                document.getElementById('printSection').innerHTML = html;
                await waitForImagesAndPrint();
            }

            // [v2.4.0] ë¶™ì—¬ë„£ê¸° ì§‘ê³„ ê¸°ëŠ¥ ë³µêµ¬
            async function importFromMessage() {
                const input = prompt('ì§ì›ì—ê²Œ ë°›ì€ ë°ì´í„°(JSON)ë¥¼ ì—¬ê¸°ì— ë¶™ì—¬ë„£ìœ¼ì„¸ìš”:');
                if (!input) return;

                try {
                    // 1. JSON íŒŒì‹± ì‹œë„
                    let data;
                    try {
                        data = JSON.parse(input);
                    } catch (e) {
                        return alert('ì˜¬ë°”ë¥¸ ë°ì´í„° í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤.\n(JSON íŒŒì‹± ì‹¤íŒ¨)');
                    }

                    // 2. ë‹¨ì¼ ë°ì´í„° ë˜ëŠ” ë°°ì—´ ì²˜ë¦¬
                    if (!Array.isArray(data)) data = [data];

                    // 3. ìœ íš¨ì„± ê²€ì‚¬ ë° ì €ì¥
                    let successCount = 0;
                    const promises = data.map(async (record) => {
                        if (record.name && record.date && record.signature) {
                            // ì´ë¯¸ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸ (ì¤‘ë³µ ë°©ì§€)
                            const current = AttendanceDB.getAll();
                            const exists = current.some(r => r.name === record.name && r.date === record.date);

                            if (!exists) {
                                await AttendanceDB.save({
                                    ...record,
                                    id: record.id || (Date.now() + Math.random()),
                                    timestamp: record.timestamp || new Date().toISOString()
                                });
                                successCount++;
                            }
                        }
                    });

                    await Promise.all(promises);

                    if (successCount > 0) {
                        AudioUtil.playSuccess();
                        alert(`${successCount}ê±´ì˜ ë°ì´í„°ê°€ ì„±ê³µì ìœ¼ë¡œ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.`);
                        renderAggregatedTable();
                    } else {
                        alert('ìƒˆë¡œ ë“±ë¡í•  ë°ì´í„°ê°€ ì—†ê±°ë‚˜ ëª¨ë‘ ì¤‘ë³µëœ ë°ì´í„°ì…ë‹ˆë‹¤.');
                    }

                } catch (e) {
                    console.error(e);
                    alert('ë°ì´í„° ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                }
            }

            async function syncServer() {
                const b = document.getElementById('syncBtn');
                const old = b.innerHTML;
                b.disabled = true; b.innerHTML = 'ë™ê¸°í™” ì¤‘...';
                try {
                    await AttendanceDB.syncSettingsWithServer();
                    const w = await AttendanceDB.syncWorkersWithServer();
                    const fy = document.getElementById('fiscalYearSelect').value;
                    const r = await AttendanceDB.syncWithServer(fy);
                    refreshAppTitles();
                    renderWorkerTable(); renderAggregatedTable();
                } catch (e) { alert('ë™ê¸°í™” ì‹¤íŒ¨'); }
                finally { b.disabled = false; b.innerHTML = old; lucide.createIcons(); }
            }

            // [v2.0.0] íšŒê¸°ë…„ë„ ê´€ë ¨ ê¸°ëŠ¥
            function initFiscalYearSelect() {
                const select = document.getElementById('fiscalYearSelect');
                if (!select) return;
                const current = FiscalYearUtil.getCurrentYear();
                select.innerHTML = '';
                for (let y = 2024; y <= current + 1; y++) {
                    const opt = document.createElement('option');
                    opt.value = y;
                    opt.innerText = `${y} íšŒê¸° (3ì›”~)`;
                    if (y === current) opt.selected = true;
                    select.appendChild(opt);
                }
            }

            async function switchFiscalYear() {
                const fy = document.getElementById('fiscalYearSelect').value;
                if (confirm(`${fy} íšŒê¸° ë°ì´í„°ë¥¼ ì„œë²„ì—ì„œ ë¶ˆëŸ¬ì˜¤ì‹œê² ìŠµë‹ˆê¹Œ?\n(í˜„ì¬ í™”ë©´ì˜ ë°ì´í„°ê°€ ë³€ê²½ë©ë‹ˆë‹¤)`)) {
                    localStorage.removeItem(DB_KEY); // ë¡œì»¬ ë°ì´í„° ë¹„ìš°ê¸°
                    await syncServer();
                }
            }

            // [v2.2.0] ê³µì§€ì‚¬í•­ ê´€ë ¨ ê¸°ëŠ¥
            function loadNotice() {
                const notice = AttendanceDB.getNotice();
                const area = document.getElementById('noticeTextArea');
                if (area) area.value = notice;
            }

            async function updateNotice() {
                const content = document.getElementById('noticeTextArea').value.trim();
                await AttendanceDB.saveNotice(content);
                AudioUtil.playSuccess();
                alert('ê³µì§€ì‚¬í•­ì´ ì €ì¥ë˜ì–´ ê²Œì‹œë˜ì—ˆìŠµë‹ˆë‹¤.');
            }

            function clearLocalRecords() {
                if (confirm('ë¸Œë¼ìš°ì € ì €ì¥ì†Œë¥¼ ë¹„ì›Œ ìš©ëŸ‰ì„ í™•ë³´í• ê¹Œìš”?\n(ì„œë²„ì—ëŠ” ë°ì´í„°ê°€ ê³„ì† ìœ ì§€ë©ë‹ˆë‹¤)')) {
                    localStorage.removeItem(DB_KEY);
                    renderAggregatedTable();
                    alert('ë¡œì»¬ ì €ì¥ì†Œê°€ ì •ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.');
                }
            }

            async function clearServerRecords() {
                const fy = document.getElementById('fiscalYearSelect').value;
                if (confirm(`${fy} íšŒê¸°ì˜ ì„œë²„ ë°ì´í„°ë¥¼ ì˜êµ¬ ì‚­ì œí• ê¹Œìš”?\nì‚­ì œ í›„ ë³µêµ¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`)) {
                    await AttendanceDB.clear(fy);
                    renderAggregatedTable();
                }
            }

            window.addEventListener('load', () => {
                initFiscalYearSelect();
                loadNotice(); // [v2.2.0] ê³µì§€ì‚¬í•­ ë¡œë“œ
                if (SERVER_CONFIG.useServer) syncServer();
            });
            renderAggregatedTable();

            // ì‹œê°„ ì˜µì…˜ ìƒì„± (v1.7.2 ë³µêµ¬)
            function populateTimeOptions() {
                const workTimeSelect = document.getElementById('wWorkTime');
                const endTimeSelect = document.getElementById('wEndTime');
                if (!workTimeSelect || !endTimeSelect) return;
                for (let hour = 0; hour < 24; hour++) {
                    for (let minute = 0; minute < 60; minute += 30) {
                        const timeValue = `${String(hour).padStart(2, '0')}:${String(minute).padStart(2, '0')}`;
                        const option1 = document.createElement('option');
                        option1.value = timeValue; option1.textContent = timeValue;
                        workTimeSelect.appendChild(option1);
                        const option2 = document.createElement('option');
                        option2.value = timeValue; option2.textContent = timeValue;
                        endTimeSelect.appendChild(option2);
                    }
                }
            }
            populateTimeOptions();

            // [v1.8.9] ì†Œë¦¬ ì•Œë¦¼ í† ê¸€ ë¡œì§
            function updateSoundUI() {
                const enabled = AttendanceDB.getSoundEnabled();
                const btn = document.getElementById('soundToggleBtn');
                const text = document.getElementById('soundStatusText');
                if (!btn) return;

                if (enabled) {
                    btn.classList.replace('btn-secondary', 'btn-primary');
                    btn.innerHTML = `<i data-lucide="volume-2"></i> <span>ì†Œë¦¬ ì¼œì§</span>`;
                    if (text) {
                        text.innerText = 'ì•Œë¦¼ ì†Œë¦¬ê°€ í™œì„±í™”ë˜ì–´ ìˆìŠµë‹ˆë‹¤.';
                        text.style.color = 'var(--primary)';
                    }
                } else {
                    btn.classList.replace('btn-primary', 'btn-secondary');
                    btn.innerHTML = `<i data-lucide="volume-x"></i> <span>ì†Œë¦¬ êº¼ì§</span>`;
                    if (text) {
                        text.innerText = 'ì•Œë¦¼ ì†Œë¦¬ê°€ ë¬´ìŒìœ¼ë¡œ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤.';
                        text.style.color = 'var(--text-muted)';
                    }
                }
                lucide.createIcons();
            }

            function toggleSoundSetting() {
                const current = AttendanceDB.getSoundEnabled();
                AttendanceDB.saveSoundEnabled(!current);
                updateSoundUI();
                if (!current) {
                    AudioUtil.playSuccess(); // ì¼¤ ë•Œë§Œ í™•ì¸ìš© ì†Œë¦¬ ì¬ìƒ
                }
            }
            // [v2.0.0] ë§¤ë‰´ì–¼ ì•„ì¹´ì´ë¹™ ì‹¤í–‰
            async function confirmManualArchive() {
                if (!confirm('í˜„ì¬ ì €ì¥ëœ ë°ì´í„°ë¥¼ ë°±ì—…í•˜ê³  "íšŒê¸° ì•„ì¹´ì´ë¹™"ì„ ì§„í–‰í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\n[ì‘ì—… ë‚´ìš©]\n1. ì „ì²´ ì¶œê·¼ê¸°ë¡ ì—‘ì…€ ë‹¤ìš´ë¡œë“œ\n2. ë¡œì»¬ ì €ì¥ì†Œ ì´ˆê¸°í™”\n3. ì¤‘ìš” ì„¤ì • ë° ëª…ë‹¨ ìœ ì§€')) return;

                try {
                    const btn = event.target.closest('button');
                    if (btn) btn.innerText = 'ë°±ì—… ë° ì´ˆê¸°í™” ì§„í–‰ ì¤‘...';

                    await AutoBackupSystem.performArchive();
                    alert('ì•„ì¹´ì´ë¹™ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.\nì•±ì´ ìµœì í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
                    location.reload();
                } catch (e) {
                    console.error(e);
                    alert('ì•„ì¹´ì´ë¹™ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                    if (btn) btn.innerText = 'ë°ì´í„° ë°±ì—… ë° ì•± ìµœì í™” (Archive)';
                }
            }

            // [v2.0.0] ì‹œì‘ ì‹œì  íšŒê¸° ë³€ê²½ ì²´í¬ ë° UI ì—…ë°ì´íŠ¸
            window.addEventListener('load', () => {
                setTimeout(() => {
                    // 1. íšŒê¸° ë³€ê²½ ê°ì§€
                    const check = AutoBackupSystem.checkSeasonChange();
                    if (check) {
                        if (confirm(check.message)) {
                            AutoBackupSystem.performArchive().then(() => {
                                alert('ì•„ì¹´ì´ë¹™ ë° ìµœì í™”ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.');
                                location.reload();
                            });
                        }
                    }

                    // 2. ì„¤ì • íƒ­ì˜ í˜„ì¬ íšŒê¸° ì •ë³´ í‘œì‹œ
                    const infoEl = document.getElementById('currentFiscalInfo');
                    if (infoEl) {
                        const storedYear = localStorage.getItem('current_fiscal_year');
                        const displayYear = storedYear ? storedYear : FiscalYearUtil.getCurrentYear();
                        infoEl.innerText = displayYear + 'ë…„ë„ (ì§„í–‰ ì¤‘)';
                        infoEl.style.color = 'var(--primary)';
                    }
                }, 1000);
            });
        </script>
    </div> <!-- End of #adminContent -->
    <div id="printSection"></div>
</body>

</html>
